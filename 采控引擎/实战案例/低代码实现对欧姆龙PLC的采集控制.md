# 低代码实现对欧姆龙PLC的采集控制

使用IoT-Fast，低代码实现对欧姆龙PLC的采集控制。IoT-Fast是一款集合了数据采集、上报云端、图形组态为一体的软件

文章以欧姆龙CP1L-E为例，包括采集，上云，组态，共分为五个部分：

+ **CX-Programmer**的使用

> 简单介绍编程软件CX-Programmer的使用。
>

+ **IoT-Fast**-采集控制系统

> 对底层设备进行数据读取、写入的配置界面，还可以进行数据处理。
>

+ **IoT-Fast**-云平台

> 将采集控制系统收集的数据进行分类展示、告警阈值设置、历史数据查询等功能。
>

+ **IoT-Fast**-云组态

> 进行2D组态，组态元素绑定云平台上展示的数据，来进行动作的执行或是数据展示。
>

+ **IoT-Fast**-微信小程序/App

> 通过微信小程序或者手机app进行远程数据的查看，以及动作的执行。
>

### 一、CX-Programmer的使用
打开欧姆龙编程软件**CX-Programmer**。

![20220616085941.png](./img/vzkcgB9Laem922Ug/1656481489935-7e6f14a9-4f27-4acb-9dbe-77be99fb0fec-800504.png)

打开CX-Programmer，点击左上角的文件，新建一个项目，选择型号CP1L-E。

![20220616090108.png](./img/vzkcgB9Laem922Ug/1656481489910-c6511319-5b59-42be-a807-5365d8b21d38-332275.png)

创建成功进入主界面。

![20220616090233.png](./img/vzkcgB9Laem922Ug/1656481489953-ce903296-dce3-4105-87d5-135e217dde47-724096.png)

项目树中双击**内存**可以查看PLC的区域和点位地址。

![20220616104557.png](./img/vzkcgB9Laem922Ug/1656481490009-1f63f316-e66c-4298-84b6-ac03c881b6d2-422414.png)

然后我们用**IoT-Fast**对D区点位进行读写。

### 二、IoT-Fast-采集控制系统
打开IoT-Fast的**采集控制**系统，选择左边的节点，按住鼠标左键拖入到中间的配置栏。

![1698909779156-4b416c66-5a08-4fd9-9b2c-b71d9e9d0fda.png](./img/vzkcgB9Laem922Ug/1698909779156-4b416c66-5a08-4fd9-9b2c-b71d9e9d0fda-922126.png)

我们从左侧的采集引擎拉出**Fins**采集控件（欧姆龙通讯协议）。

![20220617084042.png](./img/vzkcgB9Laem922Ug/1656481489923-c326b764-09aa-4ed3-a4bf-851a0bab692d-709423.png)

双击控件进入配置界面，配置采集的点位，点位的**标识符**用于和云平台进行关联对应；**功能名称**是备注的作用，方便自己理解该点位的含义，可不填；**内存域**就是PLC中的内存区，D、C、W这些；**地址**则是该内存域下的地址，具体配置如下，查询D0和D1的值。

![20220617092036.png](./img/vzkcgB9Laem922Ug/1656481490010-af61e653-f4d8-496c-b42d-2a4b71bced7a-789712.png)

点击配置界面上面的小铅笔进入通讯配置界面，填写欧姆龙PLC的ip端口等。

![20220617093147.png](./img/vzkcgB9Laem922Ug/1656481489909-61cec2a1-b533-48a5-ba07-4d179d32c7e0-429014.png)

PLC的IP在左侧的**设置**-**内置以太网**中查看。

![20220620083905.png](./img/vzkcgB9Laem922Ug/1656481489958-e647559b-4c63-4c21-aa81-9a5104e22cc7-372449.png)

端口点击**FINS/TCP设置**查看，默认9600。

![20220620084033.png](./img/vzkcgB9Laem922Ug/1656481490013-37fca4f6-7de8-4842-aa9d-ee6e1a70ab9b-638668.png)

接着从控制引擎中拉出**Fins**写入控件，对点位进行写入。

![20220620084410.png](./img/vzkcgB9Laem922Ug/1656481489911-d5c6fdb4-865a-4a7b-af2e-886ebdbd15d5-487733.png)

![20220620084458.png](./img/vzkcgB9Laem922Ug/1656481490000-e3f6acb0-88a1-4198-9c58-5b6a6d23d535-955689.png)

在通用控件中拉出**定时器**和**调试**控件。

![20220413140700.png](./img/vzkcgB9Laem922Ug/1650779619519-0d037a9a-5579-4c87-be38-a5e35d8e290b-418580.png)

在两个控件中用线两接起来，数据是从左往右流的。触发定时器时，顺着连接线对PLC进行一次采集，采集后返回的结果再顺着连接线到右边的调试控件，调试控件则会将结果显示在最右边的调试窗口。

![20220620084646.png](./img/vzkcgB9Laem922Ug/1656481490024-5139d6a8-fc1d-40c9-9ce2-935685afb153-792011.png)

完成后点击右上角的**部署**按钮。

![20220413140830.png](./img/vzkcgB9Laem922Ug/1650779619483-456bd948-a1a9-4b57-8552-131ce931cc72-615739.png)

部署完成后通讯控件会显示**连接成功**，点击定时器前面的按钮，在右边的调试窗口中能看到采集的点位数据。

![20220620084805.png](./img/vzkcgB9Laem922Ug/1656481490027-c1275f23-0bfa-465f-83c2-77d8ae853dfa-202416.png)

然后我们先去云平台创建一下产品和设备，再回过头来做数据处理。

### 三、IoT-Fast-云平台
点击云平台按钮进入**云平台**首页。

![1699000986281-453f9881-2891-43cd-92fe-e4ce6492e875.png](./img/vzkcgB9Laem922Ug/1699000986281-453f9881-2891-43cd-92fe-e4ce6492e875-009600.png)

点击左侧**产品中心**-**产品开发**，新增一个产品，类别选择**自定义品类**。

![20220620085912.png](./img/vzkcgB9Laem922Ug/1656481490061-32663d11-248d-40bc-97d6-654974cd1454-270118.png)

查看创建好的产品，在**功能定义**-**自定义参数**中新增采集控制的数据点，添加两个点位D0和D1，注意**标识符**要和采集控制系统中的**标识符**一致。

![20220620091123.png](./img/vzkcgB9Laem922Ug/1656481490001-0c243d0c-5c6c-40c5-ae1c-dbc23beecc9d-693861.png)

![20220620091045.png](./img/vzkcgB9Laem922Ug/1656481489977-834f6ddd-df12-43a4-9200-62fd10acb83f-866921.png)

![20220620091138.png](./img/vzkcgB9Laem922Ug/1656481490009-9c2b0fa9-24d7-4d62-953a-9d483715c326-292217.png)

在**功能定义**-**分组**中创建上报和下发分组。

![20220506111746.png](./img/vzkcgB9Laem922Ug/1651886261088-71fef4f7-5f4e-4e66-bca6-b95720f9de12-679307.png)

创建一个上报分组，类型选择上报，将左边的点位全选，点击右箭头，加入到当前分组中。

![20220620093627.png](./img/vzkcgB9Laem922Ug/1656481490024-e33a9dae-7eb0-491e-98d9-f98cc3a9c65d-681774.png)

创建一个下发分组，类型选择下发，一样将左边的点位加入到当前分组中。

![20220620093704.png](./img/vzkcgB9Laem922Ug/1656481490018-744553b9-7e54-4f8b-9ebb-7b1cac7f129d-905245.png)

接着点击**产品中心**-**设备管理**，在该产品下增加一个设备。

![20220620093937.png](./img/vzkcgB9Laem922Ug/1656481490038-da15dbe4-2f53-4c84-8e84-a65222ea739b-195844.png)

查看设备的**运行状态**，就能看到刚刚定义的点位已经创建出来了，后续采集控制系统上报的数据就会在这边展示。

![20220620094004.png](./img/vzkcgB9Laem922Ug/1656481490048-d0e1418d-5155-4c8b-91e8-e748f236e281-635591.png)

回到采集控制系统，从左侧云平台中拉出**iot云上行**和**iot云下行**控件。上行用于将采集的数据上报，下发用于云端下发控制指令。

![1698909708215-3dfc25b2-d299-4edd-9e8b-dd4a186fa4b7.png](./img/vzkcgB9Laem922Ug/1698909708215-3dfc25b2-d299-4edd-9e8b-dd4a186fa4b7-015283.png)

双击控件就可以选择刚刚在云平台创建的产品、设备和分组了。

![20220620094059.png](./img/vzkcgB9Laem922Ug/1656481490051-a76c9f85-f32a-4994-87c8-5301c76217cd-806269.png)

在**微联云下行**后面接一个**调试**控件，方便排查问题，然后点击部署，完成后显示连接成功，点击定时器，调试窗口显示操作成功。

![20220620094954.png](./img/vzkcgB9Laem922Ug/1656481490010-5e390519-2924-4d94-bc1c-18b163ec7a47-245593.png)

回到云平台，查看设备的**运行状态**，可以看到数据已经显示出来了。

![20220620095048.png](./img/vzkcgB9Laem922Ug/1656481490099-25dd20dc-a281-4a1c-8421-da49469894d0-085743.png)

查看设备的**设备调试**，模拟一个数据下发，写入两个值，点击发送。

![20220620151557.png](./img/vzkcgB9Laem922Ug/1656481490023-9cfe3a42-80c5-4463-aab3-54cd158a269c-965807.png)

回到采集控制系统，可以看到从云平台下发出来的报文格式。

![20220620151658.png](./img/vzkcgB9Laem922Ug/1656481490125-724b7eb3-3c74-46b8-ab34-a982195fecb0-166616.png)

我们对下发的格式做一下处理，从左侧拉出一个**F(X)** 控件，接在**微联云下行**和**S7**控制控件中间，双击写一些简单的代码，将msg.payload.data.params下的值提取到msg.payload下。

![20220620151800.png](./img/vzkcgB9Laem922Ug/1656481490068-9628e891-2ddb-4aa4-abcf-6f40ef8c56f2-443834.png)

双击**定时器**设置周期性触发，周期1s。

![20220620151901.png](./img/vzkcgB9Laem922Ug/1656481490067-0dd9ec78-be36-4762-98f2-5741c3666769-943404.png)

点击部署，采集控制系统就全部配置完成了。

![20220620152215.png](./img/vzkcgB9Laem922Ug/1656481490121-75adf4b9-ff3a-488e-923b-448d48e08fab-481819.png)

回到设备的**设备调试**，对D0和D1写入值。

![20220620152417.png](./img/vzkcgB9Laem922Ug/1656481490064-e018d9f1-b3b0-47b0-919b-e63524d9f356-683620.png)

回到**CX-Programmer**，监视内存区的D区，可以看到值已经写入了。

![20220620152610.png](./img/vzkcgB9Laem922Ug/1656481490118-15038ab2-1753-4681-a3e3-7c145f4935d4-168876.png)

再写一次，查看**CX-Programmer**和云平台的运行状态，完全一致。

![20220620153438.png](./img/vzkcgB9Laem922Ug/1656481490089-054be6e8-b276-41af-9cf5-e05089b2fec9-767519.png)

![20220620153508.png](./img/vzkcgB9Laem922Ug/1656481490067-c37bd371-d148-49ee-b367-dc60bbd967fc-070462.png)

![20220620153531.png](./img/vzkcgB9Laem922Ug/1656481490098-1eb3fd07-2319-4bd0-a4a7-d70f07a36164-690720.png)

### 四、IoT-Fast-云组态
点击云组态按钮进入**云组态**首页。

![1698909840246-ca1dbf0c-6b27-4def-9216-09eaa411aa49.png](./img/vzkcgB9Laem922Ug/1698909840246-ca1dbf0c-6b27-4def-9216-09eaa411aa49-091619.png)

先新建一个项目，填写项目名称，保存，进入项目。

![20220425141729.png](./img/vzkcgB9Laem922Ug/1651736759386-c16fcc0f-923f-4c75-a74b-4f1d3102cd28-399643.png)

点击**应用**-**我的应用**，点击图示位置新增一张图纸，来构建组态。

![20220506135444.png](./img/vzkcgB9Laem922Ug/1651886261196-4cf83ff8-72bd-4680-8441-17f80bd50eb5-572215.png)

填写图纸名称后就可以开始画组态图了。

![20220425141943.png](./img/vzkcgB9Laem922Ug/1651736759420-5e44d71e-d004-4d05-ad7c-b1c3697d311e-531857.png)

可以在左侧项目树中选择**图标**使用现成的组件，也可以在**设计**中设计自己需要的组件。

![20220506135641.png](./img/vzkcgB9Laem922Ug/1651886261268-4fe8f7ea-6613-48da-8721-3561b442c818-092407.png)

点击图纸空白处，在右侧修改图纸大小和背景颜色。

![20220629085139.png](./img/vzkcgB9Laem922Ug/1656481490161-2f567ba0-7d0a-4145-a339-7234a9d240c5-136427.png)

点击上方的文本，在图纸上拉出两个文本框，作为显示D0、D1的值。

![20220629090157.png](./img/vzkcgB9Laem922Ug/1656481490123-43bde5a5-9ea6-4fdb-a36a-112ef6504b63-471013.png)

将文本框绑定上数据，选中一个文本框，点击箭头处的图标绑定数据。

![20220629090407.png](./img/vzkcgB9Laem922Ug/1656481490107-00f307bf-d3fd-4c19-b89c-9ea0043cf77b-680333.png)

**选择数据源**-设备，**来源**-我的，**产品**-云平台创建的产品，**设备**-云平台创建的设备，**属性**-选择D0，点击确定，D1点同理进行绑定。

![20220629092234.png](./img/vzkcgB9Laem922Ug/1656481490241-925b57f6-abcf-4025-a52b-a0a265f01246-702261.png)

绑定完成后可以看到数值和云平台上的一致了。

![20220629092348.png](./img/vzkcgB9Laem922Ug/1656481490088-8184c810-c5d6-43ae-bbb3-f84cc13e39f5-278864.png)

剩下的就可以再拉一些文本框对这个数值做说明或者添加外框等处理，如下。

![20220629093559.png](./img/vzkcgB9Laem922Ug/1656481490137-a4f8d534-1306-465f-8b63-e61ff51ae87f-105481.png)

全部的开关都配置完成后点击**保存**，然后点击右上角的**预览**。

![20220418150540.png](./img/vzkcgB9Laem922Ug/1650779619647-033423b4-1f29-465a-ab41-bbd9d0062ff1-585702.png)

![20220629093757.png](./img/vzkcgB9Laem922Ug/1656481490108-cc556356-7dfc-42f4-942f-199a5c97287c-269491.png)

回到云平台的调试界面，选择下发，写入两个值。

![20220629093933.png](./img/vzkcgB9Laem922Ug/1656481490125-73b530fe-ac9d-4575-9451-cf7691d8165c-599416.png)

查看预览界面，数值实时变动。

![20220629094000.png](./img/vzkcgB9Laem922Ug/1656481490087-766f4c0a-8178-4944-b5d2-1bcc4e5d5438-095419.png)

### 五、IoT-Fast-微信小程序/APP
软件上的数据支持在**微信小程序**或者**APP**上查看，小程序和APP的二维码在**云平台**首页的右侧，目前只支持安卓APP，ios的用户可以直接用微信小程序查看。

![1699001342756-c941eb35-f81b-4e99-887c-ebf65bfff3d9.png](./img/vzkcgB9Laem922Ug/1699001342756-c941eb35-f81b-4e99-887c-ebf65bfff3d9-653629.png)

扫码进入**IoT-Fast**小程序，输入PC端注册的账号密码。

![20220609090249.png](./img/vzkcgB9Laem922Ug/1656481490126-da7c2eb9-7b4d-4c0c-b1db-141e3188bd06-358687.png)

进入首页，可以看到产品和设备数量，点击**设备**查看该账号下的所有设备。

![20220629094113.png](./img/vzkcgB9Laem922Ug/1656481490113-2d63adde-cfe9-4b18-85af-17f4541b912e-023790.png)

选择在线设备，点击查看可以看到设备的详细信息。

![20220629094136.png](./img/vzkcgB9Laem922Ug/1656481490133-08c4c813-421b-420e-99a0-bb9258e36809-114258.png)

![20220629094152.png](./img/vzkcgB9Laem922Ug/1656481490110-20d9a7b6-16ce-4d8a-8018-64d6b6debe1f-816846.png)

点击**运行状态**右侧的箭头可以查看设备的实时数据。

![20220629094222.png](./img/vzkcgB9Laem922Ug/1656481490091-8cb1a748-a1f4-4770-a43f-d7239798cf5d-254504.png)

点击**设备控制**右侧的箭头则是可以对设备进行指令下发。

![20220629094354.png](./img/vzkcgB9Laem922Ug/1656481490099-c9b96d87-ad10-4499-9ad0-ef83dc7a9c0f-676753.png)

回到首页，点击**组态**查看该账号下的所有组态，选择欧姆龙CP1L-E，点击查看。

![20220629094438.png](./img/vzkcgB9Laem922Ug/1656481490168-0d496c04-ad73-4aa2-8c36-e57c4ab3c7bc-456235.png)

和PC端一样，可以对数据进行实时查看。

![20220629095128.png](./img/vzkcgB9Laem922Ug/1656481490098-2b1c1c8a-2e4a-4a52-9161-953c2bfdb385-499738.png)



> 更新: 2024-03-21 14:20:13  
> 原文: <https://www.yuque.com/iot-fast/ckyq/lcxq6w>