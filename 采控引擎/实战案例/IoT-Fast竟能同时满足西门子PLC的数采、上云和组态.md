# IoT-Fast竟能同时满足西门子PLC的数采、上云和组态

不通过西门子的编程软件**博途**，就能对西门子PLC的点位进行读写，并且进行组态。使用IoT-Fast<font style="color:rgb(44, 62, 80);">，低代码实现</font>，IoT-Fast<font style="color:rgb(44, 62, 80);">是一款</font>集合了数据采集、上报云端、图形组态为一体的软件

文章以西门子S7-1200为例，包括梯形图，采集，上云，组态，共分为五个部分：

+ **博途**的使用

> 简单介绍编程软件博途的使用，并编写梯形图。
>

+ **IoT-Fast-**采集控制系统

> 对底层设备进行数据读取、写入的配置界面，还可以进行数据处理。
>

+ IoT-Fast-云平台

> 将采集控制系统收集的数据进行分类展示、告警阈值设置、历史数据查询等功能。
>

+ IoT-Fast-云组态

> 进行2D组态，组态元素绑定云平台上展示的数据，来进行动作的执行或是数据展示。
>

+ IoT-Fast-微信小程序/App

> 通过微信小程序或者手机app进行远程数据的查看，以及动作的执行。
>

### 一、博途的使用
打开西门子编程软件**博途**。

![20220412144217.png](./img/uYQixX4m5RMiRFH_/1650779619542-70d36a35-daca-4475-83b9-47380c1582a2-705703.png)

选择左上角的**创建新项目**，填写项目名称，以交通灯为例，选择保存路径，点击创建。

![20220412144153.png](./img/uYQixX4m5RMiRFH_/1650779619517-9de3689c-b283-4d1c-a58f-6c7497b5680f-497219.png)

创建成功后点击**打开项目视图**，进入主界面。

![20220412144301.png](./img/uYQixX4m5RMiRFH_/1650779620417-073828b2-ede4-477b-b2bb-393200fae83e-219718.png)

双击项目树中**添加新设备**，选择对应的PLC型号，确定。

![20220412144914.png](./img/uYQixX4m5RMiRFH_/1650779619562-56736a99-b2e1-4d88-868c-64ed3c453ab2-340781.png)

创建完成后选择项目树PLC中的**程序块**，双击**Main**主程序块开始编写程序。

![20220412145030.png](./img/uYQixX4m5RMiRFH_/1650779619724-5c044c71-1fb4-4734-ac2a-c50fbcb97014-016851.png)

从右边指令栏中选择需要的指令，编写交通灯的梯形图。

![20220412145248.png](./img/uYQixX4m5RMiRFH_/1650779619492-6c27481f-fb7b-4719-9c9f-2942f1b0c0f0-639729.png)

主程序**梯形图**如下，如何编写就不详细说明了。

![20220412151619.png](./img/uYQixX4m5RMiRFH_/1650779619385-df04a427-cdb4-4e14-98c0-de8a06f636f8-918489.png)  
![20220412151704.png](./img/uYQixX4m5RMiRFH_/1650779619433-60ee17f4-e074-478b-bcf6-73e29489bf05-924882.png)  
![20220412151855.png](./img/uYQixX4m5RMiRFH_/1650779619660-3e74b631-cb4b-4c99-aa14-7b00da313f86-030664.png)  
![20220412151921.png](./img/uYQixX4m5RMiRFH_/1650779619412-82b993f6-aa08-409c-8072-d9ead3c8d29f-106933.png)  
![20220412152116.png](./img/uYQixX4m5RMiRFH_/1650779619510-63d592a1-aad6-4d8a-b09c-a092e24c78ab-007156.png)  
![20220412152143.png](./img/uYQixX4m5RMiRFH_/1650779619428-fbe81af9-928e-4edf-9950-0e3177b7b933-366006.png)  
![20220412152159.png](./img/uYQixX4m5RMiRFH_/1650779619461-42c1e8d9-b1d1-41e6-8c55-d3248cb9ea4d-393292.png)

完成后下载到PLC中。

![20220412153659.png](./img/uYQixX4m5RMiRFH_/1650779619575-6dc050fb-975e-4d57-bde8-22a76dd70861-742137.png)

点击左侧**PLC变量**，**查看变量表**，下面这些点位在后续的采集和控制有需要。

![20220412153800.png](./img/uYQixX4m5RMiRFH_/1650779619549-528379ea-9f4a-4201-9ccf-53b2d6046901-520510.png)

### 二、IoT-Fast-采集控制系统
打开IoT-Fast的**采集控制**系统，选择左边的节点，按住鼠标左键拖入到中间的配置栏。

![1699003047057-4312eb54-610c-4acc-ab87-5617a6c4fb27.png](./img/uYQixX4m5RMiRFH_/1699003047057-4312eb54-610c-4acc-ab87-5617a6c4fb27-501102.png)

根据前面的梯形图，这里我们要采集6个灯和开关状态，已经对开关进行控制，所以我们从左侧的采集引擎拉出**S7**采集控件。

![20220413135706.png](./img/uYQixX4m5RMiRFH_/1650779619801-10249c1a-a131-4ae2-a9c2-549ba5aa0f54-684875.png)

双击控件进入配置界面，配置采集的点位，点位的**标识符**用于和云平台进行关联对应；**功能名称**是备注的作用，方便自己理解该点位的含义；**内存域**就是PLC中的Q、I、M、DB1等等；**地址**则是该内存域下的地址，具体配置如下。

![20220424114201.png](./img/uYQixX4m5RMiRFH_/1650779619519-c231e7cf-ee4f-4cd8-8a03-ee89b0f2ca76-268172.png)

点击配置界面上面的小铅笔进入通讯配置界面，填写西门子PLC的ip端口TSAP等。（默认端口为102，本地TSAP10.00，远程TSAP03.00）

![20220413134836.png](./img/uYQixX4m5RMiRFH_/1650779619446-f19fc894-ae93-4bc7-b54a-4dc7c0845b80-463794.png)

接着从控制引擎中拉出**S7**控制控件，同样对控制点位进行配置。

![20220413135641.png](./img/uYQixX4m5RMiRFH_/1650779619527-2b6daa08-073a-4cbf-8c5a-8837f08b0a49-927567.png)

![20220413135557.png](./img/uYQixX4m5RMiRFH_/1650779619523-1cc54c18-4020-4f34-b144-0826ae29fea2-580464.png)

在共通控件中拉出**定时器**和**调试**控件。

![20220413140700.png](./img/uYQixX4m5RMiRFH_/1650779619519-0d037a9a-5579-4c87-be38-a5e35d8e290b-444366.png)

在两个控件中用线两接起来，数据是从左往右流的。触发定时器时，顺着连接线对PLC进行一次采集，采集后返回的结果再顺着连接线到右边的调试控件，调试控件则会将结果显示在最右边的调试窗口。

![20220413140747.png](./img/uYQixX4m5RMiRFH_/1650779619528-0d35c9e9-0c5c-469a-8b34-5baed9ccea2b-757207.png)

完成后点击右上角的**部署**按钮。

![20220413140830.png](./img/uYQixX4m5RMiRFH_/1650779619483-456bd948-a1a9-4b57-8552-131ce931cc72-082336.png)

部署完成后通讯控件会显示**连接成功**，点击定时器前面的按钮，在右边的调试窗口中能看到采集的点位数据。

![20220415105305.png](./img/uYQixX4m5RMiRFH_/1650779619523-96e4aa27-75a3-4d21-be03-10385036fff2-956825.png)

然后我们先去云平台创建一下产品和设备，再回过头来做数据处理。

### 三、IoT-Fast-云平台
点击云平台按钮进入**云平台**首页。

![1699003080512-8919cea8-c678-4859-b199-45f4c68eebfd.png](./img/uYQixX4m5RMiRFH_/1699003080512-8919cea8-c678-4859-b199-45f4c68eebfd-299998.png)

点击左侧**产品中心**-**产品开发**，新增一个产品，类别选择**自定义品类**。

![20220413144240.png](./img/uYQixX4m5RMiRFH_/1650779619560-5a889174-bcbd-4483-8ca0-7c7dc0b0ff8d-695228.png)

查看创建好的产品，在**功能定义**-**自定义参数**中新增采集控制的数据点。

![20220413152424.png](./img/uYQixX4m5RMiRFH_/1650779619605-6b047fda-505f-47d3-9ce3-d1fe9603b8ad-578851.png)

配置如下，注意**标识符**要和采集控制系统中的**标识符**一致。

![20220418085358.png](./img/uYQixX4m5RMiRFH_/1650779619520-6150c7ec-a540-48e7-9e71-ef50112cd0e1-219325.png)

![20220424114013.png](./img/uYQixX4m5RMiRFH_/1650779619484-514b7093-4eaa-44bf-8d06-18abf50425e8-427480.png)

在**功能定义**-**分组**中创建上报和下发分组。

![20220413153145.png](./img/uYQixX4m5RMiRFH_/1650779619565-1b207e32-26d4-46ea-b10b-746086046bf8-391421.png)

创建一个上报分组，类型选择上报，将左边的点位全选，点击右箭头，加入到当前分组中。

![20220413153024.png](./img/uYQixX4m5RMiRFH_/1650779619521-527a4e43-a24d-429c-83dd-9e5b14bfcca5-816042.png)

创建一个下发分组，类型选择下发，一样将左边的点位加入到当前分组中。

![20220413153055.png](./img/uYQixX4m5RMiRFH_/1650779619509-b81150b8-c920-4141-bd9e-46ee27639aea-105887.png)

接着点击**产品中心**-**设备管理**，在该产品下增加一个设备。

![20220413144451.png](./img/uYQixX4m5RMiRFH_/1650779620669-9561c777-3473-4e5a-b690-02a5a872fcf2-965980.png)

查看设备的**运行状态**，就能看到刚刚定义的点位已经创建出来了，后续采集控制系统上报的数据就会在这边展示。

![20220413153328.png](./img/uYQixX4m5RMiRFH_/1650779619599-da86d50f-e921-45c3-9320-05e05a447048-467714.png)

回到采集控制系统，从左侧IoT-Fast中拉出**iotfast云上行**和**iotfast云下行**控件。上行用于将采集的数据上报，下发用于云端下发控制指令。

![1699003122308-4821348a-e211-4b28-a80f-fc71dfe75fb0.png](./img/uYQixX4m5RMiRFH_/1699003122308-4821348a-e211-4b28-a80f-fc71dfe75fb0-172095.png)

双击控件就可以选择刚刚在云平台创建的产品、设备和分组了。

![20220415134014.png](./img/uYQixX4m5RMiRFH_/1650779619763-4a81e61b-21d3-4e71-ab06-8c60d75283a0-073031.png)

在**微联云下行**后面接一个**调试**控件，方便排查问题，然后点击部署，完成后显示连接成功，点击定时器，调试窗口显示操作成功。

![20220418090039.png](./img/uYQixX4m5RMiRFH_/1650779619627-c375697c-6e79-425f-a061-dc3814498318-586763.png)

回到云平台，查看设备的**运行状态**，可以看到数据已经显示出来了。

![20220418145625.png](./img/uYQixX4m5RMiRFH_/1650779619583-7769332b-9272-47a2-98b6-6b38a8ea1002-084862.png)

查看设备的**设备调试**，模拟一个下发控制，开关选择开，点击发送。

![20220418085613.png](./img/uYQixX4m5RMiRFH_/1650779619654-68a271fb-7166-4903-a28a-66a1675c37c0-601808.png)

回到采集控制系统，可以看到从云平台下发出来的报文格式。

![20220418090205.png](./img/uYQixX4m5RMiRFH_/1650779619657-c1dc306f-e097-4e68-b678-f548c55419ae-422818.png)

我们对下发的格式做一下处理，从左侧拉出一个**F(X)** 控件，接在**微联云下行**和**S7**控制控件中间，双击写一句简单的代码，将M1_0提取到msg.payload对象下。

![20220418090730.png](./img/uYQixX4m5RMiRFH_/1650779619892-f98a9c6e-549b-4dbc-b7d6-3fc16c723142-233708.png)

双击**定时器**设置周期性触发，周期0.5s，点击部署，采集控制系统就全部配置完成了。

![20220418150803.png](./img/uYQixX4m5RMiRFH_/1650779619764-71389864-4154-4103-929f-4a33ba5fe87b-948702.png)

接着在云组态中进行交通灯的组态，然后绑定云平台的数据。

### 四、IoT-Fast-云组态
点击云组态按钮进入**云组态**首页。

![20220414135338.png](./img/uYQixX4m5RMiRFH_/1650779619533-5fa7fd6b-9b00-485b-956d-71b9e21056b2-804734.png)

先新建一个项目，填写项目名称，保存，进入项目。

![20220425141729.png](./img/uYQixX4m5RMiRFH_/1651736759386-c16fcc0f-923f-4c75-a74b-4f1d3102cd28-357705.png)

点击**应用**-**我的应用**，点击图示位置新增一张图纸，来构建组态。

![20220415151014.png](./img/uYQixX4m5RMiRFH_/1650779619563-c44420ce-b44b-4355-a33c-0edc9ef6c758-330089.png)

填写图纸名称后就可以开始画组态图了。

![20220425141943.png](./img/uYQixX4m5RMiRFH_/1651736759420-5e44d71e-d004-4d05-ad7c-b1c3697d311e-699684.png)

可以在左侧项目树中选择**图标**使用现成的组件，也可以在**设计**中设计自己需要的组件。

![20220425142402.png](./img/uYQixX4m5RMiRFH_/1651736759535-74804491-0a96-4a04-ba57-d18764ad8220-917893.png)

点击图纸空白处，在右侧修改图纸大小和背景颜色。

![20220418091805.png](./img/uYQixX4m5RMiRFH_/1650779619888-a16af489-f9ed-4456-a59a-27a962a550c2-494097.png)

从图标中拷贝一个指示灯，粘贴到设计中微调成需要的组件。

![20220425142128.png](./img/uYQixX4m5RMiRFH_/1651736759414-d9aa1cf3-e951-401c-aed1-1a1ef96a95af-417299.png)

点击设计，创建一个新的文件夹，然后粘贴指示灯，双击进行调整，调整完成后保存。

![20220425142514.png](./img/uYQixX4m5RMiRFH_/1651736759510-b2392045-961a-4f57-9468-44de1f7f4ec8-690805.png)

绘图过程就不详细介绍了，画面成型后如下，接着将灯和开关绑定云平台的数据。

![20220418101615.png](./img/uYQixX4m5RMiRFH_/1650779619728-da8b9c99-fd18-4e0d-aeb2-d4320b9e53bc-263216.png)

选中一个灯，点击箭头处的图标绑定数据。

![20220418141827.png](./img/uYQixX4m5RMiRFH_/1650779619750-57201a5e-694e-40ba-9e33-ecc2f0f015b1-082169.png)

**选择数据源**-设备，**来源**-我的，**产品**-云平台创建的产品，**设备**-云平台创建的设备，**属性**-选择东西方向绿灯，点击确定。剩下的灯和开关同理，依次进行绑定。

![20220424115927.png](./img/uYQixX4m5RMiRFH_/1650779619626-d9adf550-20ce-4fe4-b94e-ef6bafba3485-744374.png)

绑定完成后对于有控制的开关需要进行一下交互设置，选中开关，点击右上角的**交互**，双击**鼠标单击时**。

![20220419111554.png](./img/uYQixX4m5RMiRFH_/1650779619914-003758df-cab3-469b-a9d7-c6b7f3f95a5d-639987.png)

对这个控制进行命名，然后点击添加条件。

![20220419112243.png](./img/uYQixX4m5RMiRFH_/1650779619692-6aee10ef-0825-416a-b35e-31c5d68674bd-201382.png)

设置条件，当开关这个组件的值为false时触发。

![20220419112209.png](./img/uYQixX4m5RMiRFH_/1650779620187-19b2a0b1-9b86-42b4-b5ce-f78632dce0fa-190008.png)

点击左边的**数据反馈**设置交互动作，动作为：对开关写true，最后保存。

![20220424153314.png](./img/uYQixX4m5RMiRFH_/1650867252774-b8944854-4049-40a1-891e-26d57db5eab7-048893.png)

这条交互的含义是：当开关当前的值为false时，单击开关，开关会触发动作，给云端发送开关为true的指令。同样，设置一条对立的交互，开关为true时，单击开关触发false。

![20220424153428.png](./img/uYQixX4m5RMiRFH_/1650867252799-68f3d058-5fc0-4050-972d-58bfa98a28d2-532369.png)

全部配置完成后点击**保存**，然后点击右上角的**预览**。

![20220418150540.png](./img/uYQixX4m5RMiRFH_/1650779619647-033423b4-1f29-465a-ab41-bbd9d0062ff1-566854.png)

![20220419174455.png](./img/uYQixX4m5RMiRFH_/1650779619943-22ccf389-6076-435a-bf1d-2357c225f88b-638532.png)

点击开关，交通灯开始运行！

![1651800898618-7248cbff-7c07-48b3-8d17-d1cda4ae19ae.gif](./img/uYQixX4m5RMiRFH_/1651800898618-7248cbff-7c07-48b3-8d17-d1cda4ae19ae-328435.gif)

### 五、IoT-Fast-微信小程序/APP
软件上的数据支持在**微信小程序**或者**APP**上查看，小程序和APP的二维码在**云平台**首页的右侧，目前只支持安卓APP，ios的用户可以直接用微信小程序查看。

![1699003251463-c2ffdd27-5a1e-4af8-9859-f9f2be607efb.png](./img/uYQixX4m5RMiRFH_/1699003251463-c2ffdd27-5a1e-4af8-9859-f9f2be607efb-984877.png)

扫码进入IoT-Fast小程序，输入PC端注册的账号密码。

![1654594313521-cf5abdf3-a8fd-46db-9f66-64ee1f5f31f6.png](./img/uYQixX4m5RMiRFH_/1654594313521-cf5abdf3-a8fd-46db-9f66-64ee1f5f31f6-336148.png)

进入首页，可以看到产品和设备数量，点击**设备**查看该账号下的所有设备。

![1654594347250-dd0980ad-bd80-4516-b8ec-1220e30752d3.png](./img/uYQixX4m5RMiRFH_/1654594347250-dd0980ad-bd80-4516-b8ec-1220e30752d3-767983.png)

选择交通灯，点击查看可以看到设备的详细信息。

![1654596917852-03095fc7-0aed-4e98-b496-9c2af6d90011.png](./img/uYQixX4m5RMiRFH_/1654596917852-03095fc7-0aed-4e98-b496-9c2af6d90011-419103.png)

![1654596935484-3b72d1e8-ec8a-470e-9afc-619f3f96d8ed.png](./img/uYQixX4m5RMiRFH_/1654596935484-3b72d1e8-ec8a-470e-9afc-619f3f96d8ed-941816.png)

点击**运行状态**右侧的箭头可以查看设备的实时数据。

![1654596943125-bbd6212b-f412-48a7-8626-aa29d0d9542b.png](./img/uYQixX4m5RMiRFH_/1654596943125-bbd6212b-f412-48a7-8626-aa29d0d9542b-196795.png)

点击**设备控制**右侧的箭头则是可以对设备进行指令下发。

![1654596952066-c17f6842-81cb-43c1-87d1-916a3d10deb6.png](./img/uYQixX4m5RMiRFH_/1654596952066-c17f6842-81cb-43c1-87d1-916a3d10deb6-054023.png)

回到首页，点击**组态**查看该账号下的所有组态，选择交通灯，点击查看。

![1654596970514-74f8a27e-45a8-4671-ae09-3252064c8d48.png](./img/uYQixX4m5RMiRFH_/1654596970514-74f8a27e-45a8-4671-ae09-3252064c8d48-297393.png)

和PC端一样，点击按钮就可以对组态进行控制。

![1654596993182-66412b20-af1f-41ea-9dd2-6d3a2a8eb94d.png](./img/uYQixX4m5RMiRFH_/1654596993182-66412b20-af1f-41ea-9dd2-6d3a2a8eb94d-732362.png)



> 更新: 2024-03-21 14:19:42  
> 原文: <https://www.yuque.com/iot-fast/ckyq/yei4bi>