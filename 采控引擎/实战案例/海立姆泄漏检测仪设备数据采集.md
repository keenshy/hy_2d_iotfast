# 海立姆泄漏检测仪设备数据采集

本文分享一篇通过IoT-Fast软件完成海立姆泄漏检测仪设备的数据采集案例。

![1656983418761.png](./img/iCBFxF9H1geK0XpB/1657244345565-0a489db8-dfc1-46ec-bac3-b4e373ecc07c-719335.png)

文章主要共分为五个部分：

+ 前期准备

> 网络通信部署，了解通信协议，获取采集点位。
>

+ **IoT-Fast**-采集控制系统

> 对底层设备进行数据读取、写入的配置界面，还可以进行数据处理。
>

+ **IoT-Fast**-云平台

> 将采集控制系统收集的数据进行分类展示、告警阈值设置、历史数据查询等功能。
>

+ **IoT-Fast**-云组态

> 进行2D组态，组态元素绑定云平台上展示的数据，来进行动作的执行或是数据展示。
>

+ **IoT-Fast**-微信小程序/App

> 通过微信小程序或者手机app进行远程数据的查看，以及动作的执行。
>

## 一 前期准备
### 1.1 通信
将海立姆泄漏检测仪与电脑设置同一网段，接入同一个交换机保证网络可互相通信。

### 1.2 获取数据地址说明
获取海立姆泄漏检测仪通信协议以及数据地址说明，由下图知该设备为Modbus tcp 的通信协议

![20220705092623.png](./img/iCBFxF9H1geK0XpB/1657244345478-f7fb168a-b5c1-4d85-b338-87fd74a95135-020859.png)

### 1.3 **IoT-Fast**采集软件
**IoT-Fast**是一款集合了数据采集、上报云端、图形组态为一体的软件。

通过部署**采集控制**定时读取海立姆泄漏检测仪设备点位数据，将采集到的信息上传至IoT-Fast**云平台**。

## 二 IoT-Fast-采集控制系统
打开IoT-Fast的**采集控制**系统，在左侧采集引擎节点区找到**Modbus**，按住鼠标左键拖入到中间的配置区。

![20220705093756.png](./img/iCBFxF9H1geK0XpB/1657244345462-bf8f2836-7981-414a-b704-6dd6a9b31d2e-045647.png)

再从从左侧通用节点区拉出**定时器**和**调试**控件，与**Modbus**控件节点连起来，以完成网络中信息的发送接收和转发。（定时器用于定时或手动触发采集控件采集信息，调试是为了采集控件采集到的数据展示至右侧数据窗口。)

![20220705093931.png](./img/iCBFxF9H1geK0XpB/1657244345441-a10f1275-164d-4915-a5db-9fcdcb26230f-647395.png)

双击**Modbus**控件配置海立姆泄漏检测仪的连接地址以及采集的数据字典（数据地址）。

![20220705094105.png](./img/iCBFxF9H1geK0XpB/1657244345435-55927834-066b-4f08-80ce-1aa62768a965-602704.png)

根据在准备阶段设置的海立姆泄漏检测仪设备地址，点击服务器地址配置项，按要求将设备地址填入服务器配置信息。

![20220707113225.png](./img/iCBFxF9H1geK0XpB/1657244345523-6a5f1b66-5d62-4d3f-82ff-497d08a64b00-655230.png)

按照海立姆泄漏检测仪的设备数据域,选取相关的点位进行采集。

![20220705094537.png](./img/iCBFxF9H1geK0XpB/1657244345671-b7685d41-7f50-4b66-8ada-7ade41f84413-374817.png)

点击数据字典**添加**按钮，添加压力、泄漏值、存盘条码，4区对应功能码FC3的三条数据点位。

![20220707113351.png](./img/iCBFxF9H1geK0XpB/1657244345504-3957004a-87d2-42b8-b209-cb268a1f707f-446202.png)

由于条码点位采集上来的数据与现场实际数据存在错位的情况，所以我们需要对条码的数据进行处理，插入function函数，通过调整得到我们需要的条码数据。

![20220707113748.png](./img/iCBFxF9H1geK0XpB/1657244345490-1c5fed20-6ef6-462b-9b87-d54e003b58b1-408249.png)

双击**定时器**自定义设置定时器采集时间。

![20220707113828.png](./img/iCBFxF9H1geK0XpB/1657244345560-bb60b590-d4b5-4436-9e91-84715e1cd981-390629.png)

然后点击右上角的**部署**按钮，部署完成后**modbus**显示已连接，右侧的界面调到**调试窗口**显示压力、泄漏值、存盘条码三条数据。

![20220707114051.png](./img/iCBFxF9H1geK0XpB/1657244345598-20c47611-90c1-4896-bb1d-28e92054e4ee-946331.png)

另外寄存器0区，即功能码为FC1的点位需要采集，但是该点位寄存器区不同不能放在同一个modbus采集引擎中采集。所以我们重新再拉取一个modbus采集引擎组件，按照同样服务器地址配置，添加一条被检测设备是否通过检测达标的数据点位，如下所示：

![20220707114322.png](./img/iCBFxF9H1geK0XpB/1657244345641-b70e8bec-eb6a-4a2e-8a99-036af5983c7a-670634.png)

![20220707140114.png](./img/iCBFxF9H1geK0XpB/1657244345543-c82e72c7-5aa3-425f-b8b6-5531b75a44dc-094085.png)

如果需要通过用"Y"表示，NG用"N"表示，则在该组件后对数据添加function函数处理，如下：

![20220707140312.png](./img/iCBFxF9H1geK0XpB/1657244345544-42289a36-8d28-45e1-8e93-ce70f4b7172a-062820.png)

以上数据需要配合传送时间以及设备号，所以我们可以继续添加一个function函数，增加时间以及设备号的内容：

![20220707140426.png](./img/iCBFxF9H1geK0XpB/1657244345559-015a0784-15d2-4ce6-a049-c0633055b34a-508337.png)

最后将以上6个采集节点数据通过**join**组件汇总成一个负载内容输出，如下所示：

![20220707140548.png](./img/iCBFxF9H1geK0XpB/1657244345658-f2fa4b0c-a268-44b5-8cd2-830edd1c7f79-081118.png)

由于这样采集到的数据会重复，我们需要对采集上来的数据做判断过滤，此时需要一个变量点位，即通道号为26的**测试_检测**点位。该地址寄存器功能码同样为FC3类型，相同操作添加点位和服务器地址如下：

![20220707141453.png](./img/iCBFxF9H1geK0XpB/1657244345612-a28fd14e-5543-44c5-a318-1ca18b792f88-732503.png)

![20220707140737.png](./img/iCBFxF9H1geK0XpB/1657244345521-e1be6ee8-ef80-4403-a451-76a747ebdba9-689388.png)

采集上来的**测试_检测**点位是一个布尔值，即设备在运行时为true，结束时为false。

![20220707141553.png](./img/iCBFxF9H1geK0XpB/1657244345571-bc3b0145-ffaa-46e2-90bb-3464f625c85c-219219.png)

根据上传数据的规则，一台检测设备结束后才会上传一次，所以我们需要作true转false时，才可以进行下部分的压力、泄漏值、存盘条码数据采集，所以其后增加一个作比较的function函数。function里写入true转false时的代码，即前一次值和后一次比较，有变化输出一个设备检测状态值，即change、

![20220707141701.png](./img/iCBFxF9H1geK0XpB/1657244345520-c5b2cce6-3267-4fa4-ba39-38c7cacce888-202570.png)

将change值放入switch判断用的组件中，如果状态为假（有变化),即可进入下部分的点位数据采集。

![20220707141727.png](./img/iCBFxF9H1geK0XpB/1657244345530-5a7f09bd-2be4-4dd5-ab35-3d3d9596d64a-318068.png)

过滤输出所需要的内容如下：

![20220707142202.png](./img/iCBFxF9H1geK0XpB/1657244345591-5436a555-619f-4f45-b64e-5c70bd0cca0e-620796.png)

数据读取到之后，就可以将数据传到**云平台**显示，然后再进行**云组态**。

## 三 IoT-Fast-云平台
### 3.1 创建产品
点击云平台按钮进入**云平台**首页。

![20220601135713.png](./img/iCBFxF9H1geK0XpB/1654148584128-e02e9776-603a-4086-bdd4-8a6aaf3b2ba9-730439.png)

点击左侧**产品中心**-**产品开发**，新增一个产品。

![20220615083518.png](./img/iCBFxF9H1geK0XpB/1655282192376-95925652-9b36-4c54-8f56-90ac4e8e1082-670409.png)

查看创建的产品，在**功能定义**-**自定义参数**中新增属性。

![20220601140331.png](./img/iCBFxF9H1geK0XpB/1654148584120-ce0957d1-9d32-4825-b814-349ee980cf9d-079289.png)

创建配置如下，**标识符**与**采集控制**上的**key**值对应，同一个产品中不能有重复的**标识符**。

![20220707142506.png](./img/iCBFxF9H1geK0XpB/1657244345569-8e96eb8a-8383-4c1b-8a4c-d97f7d956bde-495530.png)  
![20220707142534.png](./img/iCBFxF9H1geK0XpB/1657244345536-f8e05d37-a2a4-40e6-9890-ddb838a08f8a-849316.png)

创建完成后的自定义参数如下：

![1657175248233.png](./img/iCBFxF9H1geK0XpB/1657244345608-c336cf6d-63cb-4a57-b045-edea9a0249f4-006248.png)

在**功能定义**-**分组**中创建一个上报分组，类型选择上报，将左边的点位全选，点击右箭头，加入到当前分组中。

![20220707142653.png](./img/iCBFxF9H1geK0XpB/1657244346140-d8285e9d-512b-4045-bfb0-2485dab255c7-747716.png)

如此下文中添加的设备是关联该产品的情况下，自动附带以上上报下发分组的属性，方便批量设备增加的过程。

### 3.2 添加设备
点击**产品中心**-**设备管理**，在该产品下增加一个设备。

![20220707142955.png](./img/iCBFxF9H1geK0XpB/1657244345605-f9597fab-4465-42ad-9670-8ed6329fe2cc-900307.png)

然后就是云平台和采集控制中的属性进行绑定，我们需要回到**采集控制**系统，从左侧云平台中拉出**微联云上行**控件，用于将采集的数据上报**云平台**。

![20220707143151.png](./img/iCBFxF9H1geK0XpB/1657244345657-f5a3994f-b9e8-406b-af7c-663419624e6d-093911.png)

双击控件选择将数据上报到**云平台**的气密仪器产品、设备和分组中。

### 3.3 查看数据
回到**云平台**，查看设备的**运行状态**，可以看到数据已经上传上来了。

![20220707143933.png](./img/iCBFxF9H1geK0XpB/1657244345602-a223f893-c404-47e0-8836-a27b8fc0f808-913463.png)

这样便配置好了**采集控制**和**云平台**的联动，接着可以去**云组态**进行2D组态，用图形展示数据。

## 四 IoT-Fast-云组态
### 4.1 添加应用图纸
点击云组态按钮进入**云组态**首页。

![20220601142042.png](./img/iCBFxF9H1geK0XpB/1654148584144-8320f9a9-eceb-43ec-b27a-734000bfa1f7-581495.png)

先新建一个项目，填写项目名称，保存，进入项目。

![20220601142113.png](./img/iCBFxF9H1geK0XpB/1654148584153-c6bd41b1-c3bb-4a0f-a96c-dac62e3bfaf9-983894.png)

点击**应用**-**我的应用**，点击图示位置新增一张图纸，来构建组态。

![20220601142222.png](./img/iCBFxF9H1geK0XpB/1654148584069-bc5ff08b-f648-4600-a67a-3023cfd45a90-953728.png)

填写图纸名称后就可以开始画组态图了。

![20220425141925.png](./img/iCBFxF9H1geK0XpB/1651735624498-6170a292-8c1e-43b7-b4a0-46d0664f02eb-024656.png)

### 4.2 组态绘制基础部分
![20220615154148.png](./img/iCBFxF9H1geK0XpB/1655282192481-462f9da3-d38b-45e7-96b0-7aefc2d608dc-012122.png)

由上面划分，我们可以在**设计**中设计自己需要的组件。设计完成的个性化组件可以直接拉到后面你所创建项目图纸中，重复使用，方便快捷

![20220615154810.png](./img/iCBFxF9H1geK0XpB/1655282192622-4c8508aa-0617-4adc-ba25-fc257b20cea3-223560.png)

当然也可在左侧菜单栏中选择**图标**使用现成的组件

![20220615154638.png](./img/iCBFxF9H1geK0XpB/1655282193366-1cd4733b-2e4a-482c-bb19-41524dbb3531-454684.png)

可以点击**资源**，上传截图的图片资源。

![20220615154908.png](./img/iCBFxF9H1geK0XpB/1655282192531-3d557ca6-7ba7-4f7d-8940-b3ebf3c19a8a-693906.png)

在**常用功能栏**进行所需组件的绘制，例如添加图形、添加文本、图形之间的对齐等。

![20220707161839.png](./img/iCBFxF9H1geK0XpB/1657244345856-34fdd2e9-e7df-4efc-bf4d-73798bf6c334-154756.png)

在**编辑操作区**主要是对图形边框、背影、是否立体进行操作。

![20220707161939.png](./img/iCBFxF9H1geK0XpB/1657244345645-a89e69be-3acb-44a9-a7d7-eb1347542d7d-874727.png)

### 4.3 绑定云平台数据
点击**数据源**按钮，在弹出的标签页中**选择数据源**-设备，**来源**-我的，**产品**-云平台创建的产品，**设备**-云平台创建的设备，**属性**-选择条码，点击确定。图形下方的数据源同理，依次进行绑定。

![20220707163946.png](./img/iCBFxF9H1geK0XpB/1657244345919-99c4b444-9095-44f0-9542-a91e443c45fc-248933.png)

![20220707164516.png](./img/iCBFxF9H1geK0XpB/1657244345679-13a30f51-f739-493e-8a02-d6f2dbe58bfd-494901.png)

全部完成后点击**保存**，然后点击右上角的**预览**，即可查看组态的希立气密仪器的采集动态效果。

![20220707164450.png](./img/iCBFxF9H1geK0XpB/1657244345672-f6d43faf-a798-497e-8c16-714b3bd0c75d-127190.png)

## 五 IoT-Fast-微信小程序/APP
软件上的数据支持在**微信小程序**或者**APP**上查看，小程序和APP的二维码在**云平台**首页的右侧，目前只支持安卓APP，ios的用户可以直接用微信小程序查看。

![1699001405443-c00cdd5a-fbf2-455a-870f-a4788dd6df3f.png](./img/iCBFxF9H1geK0XpB/1699001405443-c00cdd5a-fbf2-455a-870f-a4788dd6df3f-949614.png)

扫码进入**IoT-Fast**小程序，输入PC端注册的账号密码。

![20220609085115.png](./img/iCBFxF9H1geK0XpB/1655260457648-c7a7ade4-f89a-4192-a876-31ef30330d22-619216.png)

进入首页，可以看到产品和设备数量，点击**设备**查看该账号下的所有设备。

![20220609085234.png](./img/iCBFxF9H1geK0XpB/1655282192455-d1522dab-ad9b-4f65-bb53-fb00caff9cad-454895.png)

选择希立气密仪器，点击查看。

![20220708092931.png](./img/iCBFxF9H1geK0XpB/1657244345604-e9a9a493-aaaf-40fe-8a86-6f62ebb52169-294103.png)

可以看到设备的详细信息，点击运行状态查看数据。

![20220708093002.png](./img/iCBFxF9H1geK0XpB/1657244345520-58954db0-d447-430d-8db3-e502deb99577-730588.png)

![20220708093022.png](./img/iCBFxF9H1geK0XpB/1657244345798-0aa7ad3c-0f90-4f9a-9cec-f647550ebceb-970750.png)

回到首页，点击**组态**查看该账号下的所有组态，选择希立气密仪器，点击查看。

![20220708093042.png](./img/iCBFxF9H1geK0XpB/1657244345808-1f8dde10-cb42-4078-b45c-4f66d2e96fa7-961856.png)

效果和PC端是一样的。

![20220708093243.png](./img/iCBFxF9H1geK0XpB/1657244345557-1984a2cb-59e9-471a-b471-ad122a7873e4-286674.png)



> 更新: 2024-03-21 14:20:17  
> 原文: <https://www.yuque.com/iot-fast/ckyq/lif46h>