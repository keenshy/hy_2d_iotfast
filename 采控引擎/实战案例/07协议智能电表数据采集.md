# 07协议智能电表数据采集

结合实际项目，分享一则通过IoT-Fast软件以红外采集方式完成07协议智能电表的采集案例。（供电局计量总表铅封完全封闭状态，不可开启任何封印，无法采用485接线采集，转而采用红外采集的方式。）

部分现场采集场景：

![20220615161726.png](./img/2O-UbqA2pK7pVUuL/1655282192629-4ea905f4-556d-4904-8379-65c916121f67-009928.png)

![20220615161822.png](./img/2O-UbqA2pK7pVUuL/1655282192430-3bc4059a-0765-4ef4-b52a-38bd899b4d9b-369454.png)

以上为项目需要，现场安装IoT-Fast软件系统的采集控制箱，将IoT-Fast采集系统部署于终端系统中，然后将数据上传至私人部署的服务器中,完成能源监测系统大屏监管运维。

![20220610165314.png](./img/2O-UbqA2pK7pVUuL/1655282192496-1722be48-5098-4cee-ac53-12abeee11aac-005820.png)

此次为案例教程，下面将通过简化的方式进行讲解07协议智能电表采集的过程以及采集原理。文章主要共分为五个部分：

+ 前期准备

> 简单了解采集需要的设备，设备数据采集的接线方式与原理。
>

+ IoT-Fast-采集控制系统

> 对底层设备进行数据读取、写入的配置界面，还可以进行数据处理。
>

+ IoT-Fast-云平台

> 将采集控制系统收集的数据进行分类展示、告警阈值设置、历史数据查询等功能。
>

+ IoT-Fast-云组态

> 进行2D组态，组态元素绑定云平台上展示的数据，来进行动作的执行或是数据展示。
>

+ IoT-Fast-微信小程序/App

> 通过微信小程序或者手机app进行远程数据的查看，以及动作的执行。
>

## 一 前期准备
### 1.1 准备工具
| **红外采集器** | **USB转RS485转换器** | **07协议智能电表** |
| --- | :---: | :---: |
| ![20220610161525.png](./img/2O-UbqA2pK7pVUuL/1655282327901-e3135b8b-0d9f-4ef8-a57e-e97ed5541502-983352.png) | <br/>![20220615161936.png](./img/2O-UbqA2pK7pVUuL/1655282192334-a8ab5dde-602d-4837-b0fd-f2db9d2c57b6-127483.png) | ![20220610164514.png](./img/2O-UbqA2pK7pVUuL/1655282195402-0627b83c-41e0-420e-891d-c662e977e1f7-166700.png) |


### 1.2 接线方式/原理
将红外读表器对准07协议智能电表红外光口，红外采集器的RS485接入USB转RS485转换器上，再将转换器插入部署IoT-Fast软件的电脑上，通过部署**采集控制**定时读取智能电表的电能信息，将采集到的信息上传至IoT-Fast**云平台**。

![20220610162300.png](./img/2O-UbqA2pK7pVUuL/1655282192430-5956e748-bf0d-4f7a-9b00-bf9842871200-837706.png)

## 二 IoT-Fast-采集控制系统
打开IoT-Fast的**采集控制**系统，在左侧采集引擎节点区找到**DLT645-07 国家电表**，按住鼠标左键拖入到中间的配置区。

![20220615090648.png](./img/2O-UbqA2pK7pVUuL/1655282192573-9134eca1-1c9e-480f-a98a-6f56357b2e02-810631.png)

再从从左侧通用节点区拉出**定时器**和**调试**控件，与**DLT645-07 国家电表**控件节点连起来，以完成网络中信息的发送接收和转发。（定时器用于定时或手动触发采集控件采集信息，调试是为了采集控件采集到的数据展示至右侧数据窗口。)

![20220610174026.png](./img/2O-UbqA2pK7pVUuL/1655282192578-18ed4c26-6797-4a61-a719-91f66880e09f-422662.png)

双击**DLT645-07 国家电表**控件配置07协议电表的连接地址以及采集的数据字典（点位）。

![20220610174405.png](./img/2O-UbqA2pK7pVUuL/1655282192431-c20ae095-fe8e-411e-af27-177f687a747c-201476.png)

根据电表通讯文档与协议，点击服务器地址配置项，按要求填入服务器配置信息。

![20220610175847.png](./img/2O-UbqA2pK7pVUuL/1655282192645-8d659b17-3ab8-41a1-926c-6037a82c9a65-262038.png)

按照07协议的设备数据域,选取相关的点位进行采集。

![20220610180223.png](./img/2O-UbqA2pK7pVUuL/1655282192561-f793f04d-4db6-4dbb-8451-c03eac8ff7ad-841639.png)

点击数据字典**添加**按钮，添加A相电流、A相电压两条数据点位。

![20220615090427.png](./img/2O-UbqA2pK7pVUuL/1655282192387-5960b3c7-49c7-482d-8bea-2ffeac23e31f-462618.png)

双击**定时器**自定义设置定时器采集时间。

![20220615162134.png](./img/2O-UbqA2pK7pVUuL/1655282192606-dc2a97a9-0e40-47e0-838b-66c4c6a37894-484336.png)

然后点击右上角的**部署**按钮，部署完成后**DLT645-07 国家电表**显示已连接，右侧的界面调到**调试窗口**显示A相电流、A相电压两条数据。

![20220615090958.png](./img/2O-UbqA2pK7pVUuL/1655282192803-790e7cb6-2617-410e-9941-2f10804ce92d-939858.png)

数据读取到之后，就可以将数据传到**云平台**显示，然后再进行**云组态**。

## 三 IoT-Fast-云平台
### 3.1 创建产品
点击云平台按钮进入**云平台**首页。

![1699003371253-1010443a-b393-4518-8e8b-fc452a648aa5.png](./img/2O-UbqA2pK7pVUuL/1699003371253-1010443a-b393-4518-8e8b-fc452a648aa5-169967.png)

点击左侧**产品中心**-**产品开发**，新增一个产品。

![20220615083518.png](./img/2O-UbqA2pK7pVUuL/1655282192376-95925652-9b36-4c54-8f56-90ac4e8e1082-820807.png)

查看创建的产品，在**功能定义**-**自定义参数**中新增属性。

![20220601140331.png](./img/2O-UbqA2pK7pVUuL/1654148584120-ce0957d1-9d32-4825-b814-349ee980cf9d-036790.png)

创建配置如下，**标识符**与**采集控制**上的**key**值对应，同一个产品中不能有重复的**标识符**。

![20220615162506.png](./img/2O-UbqA2pK7pVUuL/1655282193342-20661158-8117-4546-a335-94d67485e998-808006.png)

在**功能定义**-**分组**中创建一个上报分组，类型选择上报，将左边的点位全选，点击右箭头，加入到当前分组中。

![20220615095928.png](./img/2O-UbqA2pK7pVUuL/1655282192416-2f4cc16f-dfca-420a-9a45-de0025a902af-567194.png)

如此下文中添加的设备是关联该产品的情况下，自动附带以上上报下发分组的属性，方便批量设备增加的过程。

### 3.2 添加设备
点击**产品中心**-**设备管理**，在该产品下增加一个设备。

![20220615100540.png](./img/2O-UbqA2pK7pVUuL/1655282193424-48e34276-2f31-4494-bfad-d29fc5098202-449041.png)

然后就是云平台和采集控制中的属性进行绑定，我们需要回到**采集控制**系统，从左侧云平台中拉出**微联云上行**控件，用于将采集的数据上报**云平台**。

![20220615100800.png](./img/2O-UbqA2pK7pVUuL/1655282193371-2ed649ac-82d3-4d70-8a90-ca4f02796a8f-384493.png)

双击控件选择将数据上报到**云平台**的智能电表产品、设备和分组中。

### 3.3 查看数据
回到**云平台**，查看设备的**运行状态**，可以看到数据已经上传上来了。

![20220615101111.png](./img/2O-UbqA2pK7pVUuL/1655282192401-e4377db0-6408-4151-908b-5b2bcad3834c-334052.png)

这样便配置好了**采集控制**和**云平台**的联动，接着可以去**云组态**进行2D组态，用图形展示数据。

## 四 Io-Fast-云组态
### 4.1 添加应用图纸
点击云组态按钮进入**云组态**首页。

![20220601142042.png](./img/2O-UbqA2pK7pVUuL/1654148584144-8320f9a9-eceb-43ec-b27a-734000bfa1f7-247669.png)

先新建一个项目，填写项目名称，保存，进入项目。

![20220601142113.png](./img/2O-UbqA2pK7pVUuL/1654148584153-c6bd41b1-c3bb-4a0f-a96c-dac62e3bfaf9-468226.png)

点击**应用**-**我的应用**，点击图示位置新增一张图纸，来构建组态。

![20220601142222.png](./img/2O-UbqA2pK7pVUuL/1654148584069-bc5ff08b-f648-4600-a67a-3023cfd45a90-053652.png)

填写图纸名称后就可以开始画组态图了。

![20220425141925.png](./img/2O-UbqA2pK7pVUuL/1651735624498-6170a292-8c1e-43b7-b4a0-46d0664f02eb-007383.png)

### 4.2 组态绘制基础部分
![20220615154148.png](./img/2O-UbqA2pK7pVUuL/1655282192481-462f9da3-d38b-45e7-96b0-7aefc2d608dc-691804.png)

由上面划分，我们可以在**设计**中设计自己需要的组件。设计完成的个性化组件可以直接拉到后面你所创建项目图纸中，重复使用，方便快捷

![20220615154810.png](./img/2O-UbqA2pK7pVUuL/1655282192622-4c8508aa-0617-4adc-ba25-fc257b20cea3-008102.png)

当然也可在左侧菜单栏中选择**图标**使用现成的组件

![20220615154638.png](./img/2O-UbqA2pK7pVUuL/1655282193366-1cd4733b-2e4a-482c-bb19-41524dbb3531-460209.png)

可以点击**资源**，上传截图的图片资源。

![20220615154908.png](./img/2O-UbqA2pK7pVUuL/1655282192531-3d557ca6-7ba7-4f7d-8940-b3ebf3c19a8a-561799.png)

在**常用功能栏**进行所需组件的绘制，例如添加图形、添加文本、图形之间的对齐等。

![20220615155407.png](./img/2O-UbqA2pK7pVUuL/1655282199447-8caab959-ba95-410e-b1bf-6a8b105cafee-109894.png)

在**编辑操作区**主要是对图形边框、背影、是否立体进行操作。

![20220615155906.png](./img/2O-UbqA2pK7pVUuL/1655282192478-42e41e44-ca07-41ea-98b2-ad18fd97a539-528522.png)

### 4.3 绑定云平台数据
点击**数据源**按钮，在弹出的标签页中**选择数据源**-设备，**来源**-我的，**产品**-云平台创建的产品，**设备**-云平台创建的设备，**属性**-选择燃气浓度，点击确定。图形下方的的电源指示灯以及其他的设备数据源同理，进行绑定。

![20220615160636.png](./img/2O-UbqA2pK7pVUuL/1655282192703-44fe5ff1-9a25-4303-9bbb-7755287d9d6a-367227.png)

![20220615160703.png](./img/2O-UbqA2pK7pVUuL/1655282192592-e08da1da-8490-4a24-b6b1-5a9bf0673cf2-594122.png)

全部完成后点击**保存**，然后点击右上角的**预览**，即可查看组态的07协议智能电表的采集动态效果。

![1655459542539-776e0cb9-4551-4564-83b5-06b6edc3244b.png](./img/2O-UbqA2pK7pVUuL/1655459542539-776e0cb9-4551-4564-83b5-06b6edc3244b-614168.png)

## 五 IoT-Fast-微信小程序/APP
软件上的数据支持在**微信小程序**或者**APP**上查看，小程序和APP的二维码在**云平台**首页的右侧，目前只支持安卓APP，ios的用户可以直接用微信小程序查看。

![1699003388981-3dd22ebe-a2d5-4ec2-9423-63574bdc2338.png](./img/2O-UbqA2pK7pVUuL/1699003388981-3dd22ebe-a2d5-4ec2-9423-63574bdc2338-657819.png)

扫码进入IoT-Fast小程序，输入PC端注册的账号密码。

![20220609085115.png](./img/2O-UbqA2pK7pVUuL/1655260457648-c7a7ade4-f89a-4192-a876-31ef30330d22-048705.png)

进入首页，可以看到产品和设备数量，点击**设备**查看该账号下的所有设备。

![20220609085234.png](./img/2O-UbqA2pK7pVUuL/1655282192455-d1522dab-ad9b-4f65-bb53-fb00caff9cad-553790.png)

选择07协议智能电表，点击查看。

![20220615161116.png](./img/2O-UbqA2pK7pVUuL/1655282193470-422fa2ee-ff05-4737-abb2-d56efb602c97-970199.png)

可以看到设备的详细信息，点击运行状态查看电表数据

![20220615161208.png](./img/2O-UbqA2pK7pVUuL/1655282192422-fdcc0dcd-ee84-4c2c-bda1-37e5e4a8d6b7-101467.png)  
![20220615161256.png](./img/2O-UbqA2pK7pVUuL/1655282195386-1955fe10-c217-420a-9341-805fa3cd488f-794095.png)

回到首页，点击**组态**查看该账号下的所有组态，选择07协议智能代表，点击查看。

![20220615161343.png](./img/2O-UbqA2pK7pVUuL/1655282193412-e484b900-41ce-479d-a924-5571fcaaf443-154291.png)

效果和PC端是一样的。

![1655459729580-07df6385-dfed-41f2-a034-e4834b08a255.png](./img/2O-UbqA2pK7pVUuL/1655459729580-07df6385-dfed-41f2-a034-e4834b08a255-228101.png)



> 更新: 2024-03-21 14:20:05  
> 原文: <https://www.yuque.com/iot-fast/ckyq/khnnrz>