# 如何使用IoT-Fast组态软件采集监控永宏PLC的IO点位状态

本文将通过永宏PLC点位采集控制的组态案例和大家分享一款名为IoT-Fast的物联网软件。

![20220429143219.png](./img/GnzDTEvdxjTOFvek/1651737894246-ad96be3c-6978-451d-95b7-0387896621bf-691714.png)

软件集合了数据采集、上报云端、图形组态为一体，仅三步就让你快速完成设备的数据采集控制组态项目，下面我们详细介绍该套软件的操作案例，以采集监控永宏PLC的IO点位状态为例，文章主要分为五个部分：

+ 前期准备

> 永宏跑马灯的介绍：设备的连线，串口服务器IP和端口的配置。
>

+ IoT-Fast-采集控制系统

> 对底层设备进行数据读取、写入的配置界面，还可以进行数据处理。
>

+ IoT-Fast-云平台

> 将采集控制系统收集的数据进行分类展示、告警阈值设置、历史数据查询等功能。
>

+ IoT-Fast-云组态

> 进行2D组态，组态元素绑定云平台上展示的数据，来进行动作的执行或是数据展示。
>

+ IoT-Fast-App

> 通过手机app进行远程数据的查看，以及动作的执行。
>

## 一、前期准备
### 1.1 准备工具
实现采集监控永宏PLC的IO点状态组态案例，需要准备以下工具：

+  一台永宏plc，该案例采用的永宏PLC型号为FBs-14MCR2-AC； 
+  一个按钮开关，用于物理控制跑马灯启动关闭； 
+  一对LED灯，该案例采用四个灯展示。 



![20200730162758.png](./img/GnzDTEvdxjTOFvek/1597367839629-c4f13ac0-9fb4-4612-a0e3-cf433d8fef4c-705600.png)

此案例所使用的永宏PLC正面有一个网口，除此之外，分别还有电源、外部接门磁门锁的485口和接读卡器的韦根接口。这里只需要把电源和网线接上就行。但需要给永宏PLC先分配一个IP地址（新设备会有一个初始IP地址），我们需要下载修改IP的软件Fatek Ethernet Module Configuration setup进行IP设置。

![20200730170441.png](./img/GnzDTEvdxjTOFvek/1597367839491-2affb674-e39f-4579-8ba4-06512e2fb7f5-256201.png)

### 1.2 永宏PLC软件WinProladder应用
首先简单说明一下WinProladder的使用，是永宏PLC的编程软件之一，用于编写梯形图和修改PLC参数等。

![%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200710084705.png](./img/GnzDTEvdxjTOFvek/1597367839696-ffdbac7d-5c79-406a-ad54-3928962d40de-302838.png)

#### 1.2.1 连接PLC
打开WinProladder软件，单击**档案**，选择**开新专案**，点击**编辑**，选择PLC的型号，点击确定，具体操作如下。

![2020071001.jpg](./img/GnzDTEvdxjTOFvek/1597367839670-3b2402d4-74bf-4993-825b-cc8fd6e2b00a-810157.jpeg)

#### 1.2.2 修改软件连接设备的IP地址和配置端口
在**PLC**中找到**联机**，点击**编辑**，修改PLC的IP地址和本地模块一致。配置端口和勾选连接机制，最后点击确定即可。（如果是新的PLC首次连接，要先将电脑IP修改为和PLC同一个网段，PLC和电脑用网线直连通讯，然后修改PLC的IP，重启PLC之后就可以通过交换机以太网通讯了。）

![2020071003.jpg](./img/GnzDTEvdxjTOFvek/1597367843646-6509d723-a7b7-4af6-9353-576a551e8d68-260848.jpeg)

### 1.3 梯形图
#### 1.3.1 编写
WinProladder中输入为X，输出为Y，中间寄存器为M。M可读可写，X和Y可读，因此要控制输出点Y的通断，只能通过M或其它可写入点间接控制Y，如下图，用M1、M2、M3、M4分别控制输出Y1、Y2、Y3、Y4。

![20200730170634.png](./img/GnzDTEvdxjTOFvek/1597367844037-7a6493fa-3bec-41ab-abb4-ff38a43fc506-951638.png)

#### 1.3.2 联机
写好程序后，点击**PLC**下的**联机**，将程序和参数下载到PLC当中，再点击**执行**。

![20200730170823.png](./img/GnzDTEvdxjTOFvek/1597367844090-63df3638-9fca-4298-9a4d-46fdb6903a51-236380.png)

## 三、IoT-Fast-采集控制系统
使用IoT-Fast采集控制系统对永宏PLC跑马灯进行采集和控制。

![20220507101951.png](./img/GnzDTEvdxjTOFvek/1651906912320-07c63d9c-d1c9-4cbc-b897-5b61bc0c1df8-771758.png)

### 1.控件选择
从左边的控制引擎和采集引擎中分别拖出永宏控件。

![2020071006.jpg](./img/GnzDTEvdxjTOFvek/1597367847764-25a7947f-0753-4b11-afbc-f0b262859c5d-963961.jpeg)

按下图配置，上面是是读取的采集引擎，下面是写入的控制引擎。

![20220506141620.png](./img/GnzDTEvdxjTOFvek/1651906912138-3f0dface-edb7-46f3-bbef-42d35b9eb167-724274.png)

### 2.控件节点配置
Fatek-Write的配置如下:

| 添加4个控制量，分别为M1-M4，类型为布尔，值就是写入的值（0或者1） | 地址和端口是根据配置好的PLC地址和端口填入 |
| --- | --- |
| ![20200730171440.png](./img/GnzDTEvdxjTOFvek/1597367847002-8c26596c-c0d5-4bb1-8f2b-fce412f1a0bb-490854.png) | ![20200730171554.png](./img/GnzDTEvdxjTOFvek/1597367846966-74e3439b-e58b-4ac0-a74d-330ee782133c-270934.png) |


Fatek-Read的配置大致相同，读取M0-M4以及Y1-Y4 9个点的状态。

![20200731082259.png](./img/GnzDTEvdxjTOFvek/1597367847113-325ee504-60de-4354-a32d-f02449d26eaa-454650.png)

配置完成后，在Fatek-Write节点中将M1和M3的值改成1，然后点击部署![20200722101620.png](./img/GnzDTEvdxjTOFvek/1597367847216-995749c0-d86b-4dff-9931-2f0e3e7ee70c-689442.png)。

![20200731082422.png](./img/GnzDTEvdxjTOFvek/1597367847336-720ad67d-323f-4a24-bc7c-8102249fab0c-554485.png)

### 3.流程部署调试
点击写入定时器，调试界面显示写入成功，然后点击读取定时器，显示M1和M3以及Y1和Y3的值为true。

![20200731082947.png](./img/GnzDTEvdxjTOFvek/1597367847658-1f52efc2-03de-478b-8d5e-fdb3fbd7be98-087866.png)

回到WinProladder的监视界面，可以看到M1和M3以及Y1和Y3闭合。

![20200731083024.png](./img/GnzDTEvdxjTOFvek/1597367849068-12ebd083-be8a-40b4-bdbb-dad6344aa061-885986.png)

再试一次，M1-M4写入0101，点击部署，点击写入和读取定时器，查看WinProladder的监视界面。

![20200731083627.png](./img/GnzDTEvdxjTOFvek/1597367849107-faa0db40-feca-4c81-bb46-fd8794e0c071-117443.png)



![20200731083812.png](./img/GnzDTEvdxjTOFvek/1597367849561-685ddcce-8526-4a7a-b7b6-c9a791329454-291297.png)



![20200731083837.png](./img/GnzDTEvdxjTOFvek/1597367849123-853f9f5f-aeac-4f62-ab18-662a4e57508e-020417.png)

成功对PLC进行读取和写入了，文章末尾附上快速复用码，导入便可快速部署。

## 四、IoT-Fast-云平台
**IoT-Fast云平台**能够与**IoT-Fast采集控制系统**进行联动，将采集到的数据可视化。

![1699003873888-ef16e4b6-f3e9-4d16-a108-1925b31af9ba.png](./img/GnzDTEvdxjTOFvek/1699003873888-ef16e4b6-f3e9-4d16-a108-1925b31af9ba-214487.png)

### 1. 产品和设备的创建
登录**IoT-Fast云平台**，依次点击设备管理-产品-创建产品。

![20220506144436.png](./img/GnzDTEvdxjTOFvek/1651906912093-6975aaa6-bd0e-47e1-a0cc-7dd5aa1fc616-342754.png)

然后在该产品下创建一个设备，操作顺序如下图，最后点击确定即可。

![20220506151103.png](./img/GnzDTEvdxjTOFvek/1651906912051-a8828a33-bb23-4c95-9473-ff89c2bab800-411949.png)

### 2. 采集量的定义
回头查看刚刚创建的产品，在功能定义中，自定义功能中添加采集量。

![20220506151300.png](./img/GnzDTEvdxjTOFvek/1651906912105-3a58500b-b4b1-4db2-a36d-44ca87aa365e-186521.png)

**注**：**标识符**一定要和采集引擎中的**标识符**一致，功能名称无所谓。

![20220506151811.png](./img/GnzDTEvdxjTOFvek/1651906912136-8db81b0d-4d1e-45b5-91d3-59047f823063-748512.png)

所有灯光功能自定义添加完成如下：

![20220506153306.png](./img/GnzDTEvdxjTOFvek/1651906912134-59f49136-0b39-4cac-9d57-2823224c5b88-867644.png)

### 3. 可视化控件部署调试
回到IoT-Fast采集控制系统，在IoT-Fast云平台中拖出海创上行和下发，点击节点进行产品设备的选择配置。控件显示连接成功后，读取数据的数据即可展示在右方调试界面。

![20220507103047.png](./img/GnzDTEvdxjTOFvek/1651906912130-454ca381-b659-46a9-9e06-336251c644f7-715429.png)

回到**IoT-Fast云平台**，在设备的运行状态中可以实时显示LED灯的状态了。

![20220506154853.png](./img/GnzDTEvdxjTOFvek/1651906913038-cbe603d4-4ffe-439f-aa59-50ed95efb334-042484.png)

## 五、IoT-Fast-云组态
完成组态的创建需要以下三个小步骤：

### 4.1 创建项目及应用
点击云组态按钮进入**云组态**首页。

![20220414135338.png](./img/GnzDTEvdxjTOFvek/1650779619533-5fa7fd6b-9b00-485b-956d-71b9e21056b2-335560.png)

先新建一个项目，填写项目名称，保存，进入项目。

![20220428151312.png](./img/GnzDTEvdxjTOFvek/1651737894229-d1742e3a-0ca7-421d-a13c-714929891ac2-227123.png)

点击**应用**-**我的应用**，点击图示位置新增一张图纸，来构建组态。

![20220415151014.png](./img/GnzDTEvdxjTOFvek/1650779619563-c44420ce-b44b-4355-a33c-0edc9ef6c758-650621.png)

填写图纸名称后就可以开始画组态图了。

### 4.2 设计所需模型图标
以在左侧项目树中选择**图标**使用现成的组件，也可以在**设计**中设计自己需要的组件。设计完成的个性化组件可以直接拉到后面你所创建项目图纸中，重复使用，方便快捷。

![20220425142423.png](./img/GnzDTEvdxjTOFvek/1651735624546-9fe25fd0-d9e3-4bc9-8693-83f4aa0ca7d9-144714.png)



下面以LED指示灯为例，介绍软件绘画中涉及线段、图形、文本、图形对齐的编辑，以及修改图形的背景颜色、线条宽度等操作。具体操作入径如下图所示，是不是很明了简单呢。

![1699004064703-ea9d4e0e-e4eb-43e3-9e55-9d0fc400376f.png](./img/GnzDTEvdxjTOFvek/1699004064703-ea9d4e0e-e4eb-43e3-9e55-9d0fc400376f-183488.png)

组件基础部分设计完成后，即可拖拽至项目应用图纸中。

![20220506162726.png](./img/GnzDTEvdxjTOFvek/1651906912502-1c590c86-0684-44cc-aa2b-945680673157-716205.png)

灯光组件中的LED灯颜色是不同的，并且满足可控制可绑定数据的要求，我们需要单独进行LED指示灯组件的设计，设计过程和上面介绍相同。

![1652059082281-41c7afe1-6228-4a36-a880-3cab2d551513.png](./img/GnzDTEvdxjTOFvek/1652059082281-41c7afe1-6228-4a36-a880-3cab2d551513-508445.png)

然后我们将指示灯组件拖拽至项目应用图纸中，在原有基础上设定该指示灯接通和断开状态的颜色。

![20220506162902.png](./img/GnzDTEvdxjTOFvek/1651906912148-f494323f-6789-4afc-b45c-0103e07af767-502579.png)

### 4.3 绑定云平台数据
图形绘画完成，下一步就可以通过采集系统采集到的设备灯光状态上传至云平台的数据绑定到组态上。只要我们选中指定灯光组件，点击基础配置页面中绑定数据源按钮。

![20220507103441.png](./img/GnzDTEvdxjTOFvek/1651906912514-b2d9b2cb-989a-4945-80e4-019b19a21b31-634044.png)

在弹出的标签页中**选择数据源**-设备，**来源**-我的，**产品**-云平台创建的产品，**设备**-云平台创建的设备，**属性**-选择灯1状态，点击确定。下面的灯光以及其他的设备数据源同理，进行绑定。

![20220507103602.png](./img/GnzDTEvdxjTOFvek/1651906912317-fddc7fd3-bf5a-4bed-a666-0e7d06dfcea3-545829.png)

全部完成后点击**保存**，然后点击右上角的**预览**，即可查看组态的永宏PLC跑马灯动态效果。

在这个案例中我们详细介绍一下交互的功能操作，即通过点击组态上的设备控制实际的设备执行相应的操作。以灯光1为例，鼠标单击灯光1节点让实际的灯光1设备亮起。

首先我们点击灯光1节点，在“交互”操作栏下选择“鼠标单击时”。

![20220507104108.png](./img/GnzDTEvdxjTOFvek/1651906912184-ca648c37-1197-4ad8-bf87-53c9c6735bfb-135857.png)

在弹出的标签页中，点击“添加条件”

![20220507104302.png](./img/GnzDTEvdxjTOFvek/1651906912133-446aeb9b-a304-465f-a0ee-a4166296e0f4-806844.png)

我们设置灯光1实际为亮的情况下为前提条件

![20220507104501.png](./img/GnzDTEvdxjTOFvek/1651906912253-3dd3e02e-b97b-4c70-857e-3169805a47f3-903706.png)

上一步操作确定后会返回事件编辑页面，我们选择“数据反馈”，弹出动作配置页面，选择相应设备属性，配置值为false，即关闭灯光1。

![20220507104658.png](./img/GnzDTEvdxjTOFvek/1651906912149-fb647522-c32f-4851-a815-9ab7d637b290-586703.png)

其他节点依照此操作一一配置完成，返回组态页面，即可实现灯光单点控制。

![20220507105302.png](./img/GnzDTEvdxjTOFvek/1651906915169-307db4cd-f7ef-4f87-a521-cc41dc3fcf6a-851356.png)

## 五、IoT-Fast-微信小程序/APP
软件上的数据支持在**微信小程序**或者**APP**上查看，小程序和APP的二维码在**云平台**首页的右侧，目前只支持安卓APP，ios的用户可以直接用微信小程序查看。

![1699004232475-7f916f9a-5726-47c5-8811-b2a113d2b0f6.png](./img/GnzDTEvdxjTOFvek/1699004232475-7f916f9a-5726-47c5-8811-b2a113d2b0f6-410282.png)

扫码进入IoT-Fast小程序，输入PC端注册的账号密码进入首页。

![1699004292862-fa550155-7394-4329-a5e5-a3e35f58e0d4.png](./img/GnzDTEvdxjTOFvek/1699004292862-fa550155-7394-4329-a5e5-a3e35f58e0d4-922956.png)

![20220506163955.png](./img/GnzDTEvdxjTOFvek/1651906912161-c2355cb1-807e-4e97-aad6-0ae29d128de8-873255.png)

选择永宏PLC跑马灯设备，点击查看可以看到设备的详细信息。

![20220507112715.png](./img/GnzDTEvdxjTOFvek/1651906912140-52f37b10-ea5c-45b9-9680-3f8ae3195864-198527.png)

点击运行状态右侧箭头可以查看设备的实时数据。

![20220507112750.png](./img/GnzDTEvdxjTOFvek/1651906912115-a9b95665-4ade-49a4-b439-520d39ea0665-870623.png)

点击设备控制右侧箭头可以控制设备的状态。

![20220507112910.png](./img/GnzDTEvdxjTOFvek/1651906912122-0a346825-9d14-4f0e-96a3-d16e64f25f6c-725338.png)

回到首页，点击组态查看该账号下的所有组态，选择永宏PLC跑马灯这个组态，点击查看。

![20220507112947.png](./img/GnzDTEvdxjTOFvek/1651906912171-18a5e704-d9d5-48cb-9c36-d65617e62e99-627115.png)

在组态页面中同样支持灯的单点控制。

![1652059258726-18239887-89bb-4930-8ee6-22f3deb69060.png](./img/GnzDTEvdxjTOFvek/1652059258726-18239887-89bb-4930-8ee6-22f3deb69060-295093.png)



> 更新: 2024-03-21 14:19:45  
> 原文: <https://www.yuque.com/iot-fast/ckyq/cyrvoe>