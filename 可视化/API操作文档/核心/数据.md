# 数据

<font style="color:rgb(28, 30, 33);">DataBase 负责保管应用的一切数据。对 DataBase 的操作会影响到整个应用的数据状态,需要更加谨慎。</font>

## <font style="color:rgb(28, 30, 33);">获取 DataBase 对象</font>
```javascript
const app = new Application({
  container: document.getElementById("container"),
});
const dataBase = app.DataBase;
```

## <font style="color:rgb(28, 30, 33);">主要结构</font>
<font style="color:rgb(28, 30, 33);">DataBase 最主内容有以下几块：</font>

+ [<font style="color:rgb(28, 30, 33);">NodeSpace</font>](https://v2-doc.gkiiot.com/docs/Core/database#nodespace)<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">节点数据。所有画布上的节点信息都会保存在这里。</font>
+ [<font style="color:rgb(28, 30, 33);">AnimationTable</font>](https://v2-doc.gkiiot.com/docs/Core/database#animationtable)<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">动画数据。所有节点的动画信息都会保存在这里。</font>
+ [<font style="color:rgb(28, 30, 33);">CollectionTable</font>](https://v2-doc.gkiiot.com/docs/Core/database#collectiontable)<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">组合数据。组合是将多个节点放置在一个</font>**<font style="color:rgb(28, 30, 33);">组合块</font>**<font style="color:rgb(28, 30, 33);">里面。对组合的操作会影响到组合内的所有节点。</font>
+ [<font style="color:rgb(28, 30, 33);">LayerTable</font>](https://v2-doc.gkiiot.com/docs/Core/database#layertable)<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">图层数据。一个应用可以有多个图层，用户经常会在不同的图层上绘制不同的内容，通过切换图层进行一些创造。</font>
+ [<font style="color:rgb(28, 30, 33);">HistoryManager</font>](https://v2-doc.gkiiot.com/docs/Core/database#historymanager)<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">操作历史。所有的操作都会被记录在这里，可以通过撤销和重做来查看历史操作。</font>

### <font style="color:rgb(28, 30, 33);">NodeSpace</font>
```tsx
const nodeSpace = dataBase.NodeSpace;
```

| 方法名 | 返回类型 | 描述 | 示例 |
| --- | --- | --- | --- |
| Entitys | BaseNode[] | 获取所有节点 | `nodeSpace.Entitys` |
| append | void | 添加节点 | `nodeSpace.append(node)`<br/> node 类型为 BaseNode |
| remove | void | 删除节点 | `nodeSpace.remove(node)`<br/> node 类型为 BaseNode |
| onAppend | void | 添加节点事件 | `nodeSpace.onAppend.add((n: BaseNode) => n.Position= {x:0, y: 0})` |




### <font style="color:rgb(28, 30, 33);">AnimationTable</font>
```tsx
const animationTable = dataBase.AnimationTable;
```

| 方法名 | 返回类型 | 描述 | 示例 |
| --- | --- | --- | --- |
| Objects | BaseAnimation[] | 获取所有动画 | `animationTable.Objects` |
| append | void | 添加动画 | `animationTable.append(animation)`<br/> animation 类型为 BaseAnimation |
| remove | BaseAnimation | 删除动画 | `animationTable.remove(121)`<br/> 121 为实际要删除的动画 ID |


### <font style="color:rgb(28, 30, 33);">CollectionTable</font>
```tsx
const collectionTable = dataBase.CollectionTable;
```

| 方法名 | 返回类型 | 描述 | 示例 |
| --- | --- | --- | --- |
| append | void | 添加组合 | `collectionTable.append(collection)`<br/> collection 类型为 CollectionRecord |
| remove | void | 删除组合 | `collectionTable.remove(collection)`<br/> collection 类型为 CollectionRecord |
| objects | CollectionRecord[] | 获取所有组合 | `collectionTable.objects` |


### <font style="color:rgb(28, 30, 33);">LayerTable</font>
```tsx
const layerTable = dataBase.LayerTable;
```

| 方法名 | 返回类型 | 描述 | 示例 |
| --- | --- | --- | --- |
| ActiveLayer | LayerNode | 获取当前图层 | `layerTable.ActiveLayer` |
| ActiveLayerId | number/void | 获取/设置当前图层 ID | `const id = layerTable.ActiveLayerId`<br/> `layerTable.ActiveLayerId = 121` |
| Layers | LayerNode[] | 获取所有图层 | `layerTable.Layers` |
| append | void | 添加图层 | `layerTable.append(layer)`<br/> layer 类型为 LayerNode |
| remove | void | 删除图层 | `layerTable.remove(layer)`<br/> layer 类型为 LayerNode |
| setActiveLayerByName | boolean | 根据名称设置图层 | layerTable.setActiveLayerByName("图层名称"); |


### <font style="color:rgb(28, 30, 33);">HistoryManager</font>
```tsx
const historyManager = dataBase.HistoryManager;
```

## <font style="color:rgb(28, 30, 33);">属性 & 方法</font>
| 方法名 | 返回类型 | 描述 | 示例 |
| --- | --- | --- | --- |
| startCmd | void | 开始命令， 将操作记录至历史记录里 | `historyManager.startCmd("拖拽", true)` |
| endCmd | void | 结束命令 | `historyManager.endCmd()` |
| HasUndo | boolean | 是否有撤销 | `historyManager.HasUndo` |
| HasRedo | boolean | 是否有重做 | `historyManager.HasRedo` |
| undo | boolean | 撤销操作 | `historyManager.undo()` |
| redo | boolean | 重做操作 | `historyManager.redo()` |
| clear | void | 清空历史 | `historyManager.clear()` |




> 更新: 2025-02-07 18:25:06  
> 原文: <https://www.yuque.com/iot-fast/ksh/qnmwfdub2z400xer>