# 常见脚本使用汇总

### 一、获取节点数据和设置节点数据
![1735888303411-74e9e69b-ccc5-467a-befe-2bda31a96d88.png](./img/WkiK6gaYfs6aOXMB/1735888303411-74e9e69b-ccc5-467a-befe-2bda31a96d88-410512.png)

![1735888831505-a83dd3a0-07b1-41c2-8f1a-6bfef2c10b7e.png](./img/WkiK6gaYfs6aOXMB/1735888831505-a83dd3a0-07b1-41c2-8f1a-6bfef2c10b7e-475827.png)

获取我的/设计里的组件；系统控件、基础以及图表组件的数据列对应的数据均可通过以下脚本实现：

```javascript
//获取列表下第一个节点名称为标签属性title的值
app.getNodeByName("标签")[0].getOutputData().title
//获取标识为106节点属性title的值
app.getNodeById(106).getOutputData().title

```

设置我的/设计里的组件；系统控件、基础以及图表组件的数据均可通过以下脚本实现：

```javascript
//设置列表下第一个节点名称为标签属性title的值为111
app.getNodeByName("111")[0].setData({ title: "111" })
//设置标识为106节点属性title的值为222
app.getNodeById(106).setData({ title: "222" })
```

### 二、获取和设置组合节点
阵列组合<font style="color:#8A8F8D;">（通过单个节点右击可选择阵列组合）</font>和组合节点<font style="color:#8A8F8D;">（通过多选节点后右击可选择组合节点）</font><font style="color:#000000;">获取和实现方式一致，如下：</font>

```javascript
//遍历标识为125的阵列组合或组合下的节点
app.getObjectById(125).Entitys.forEach(e => {//遍历阵列或组合
    const node = e.object;//获取阵列或组合下单个节点对象
    const title = node.getOutputData().title;//获取节点的某个属性值.例如title
    node.setData({ title: "你好阿" })//设置节点某个属性的值
    node.on("click", () => {//节点单击动作
    //编辑动作内容
    })
})
```

### 三、图层切换
1. 蓝图实现：

![1736143801888-43455e33-dc49-48b5-89a2-f78c5688e6d4.png](./img/WkiK6gaYfs6aOXMB/1736143801888-43455e33-dc49-48b5-89a2-f78c5688e6d4-557434.png)

2. 脚本实现：

```javascript
//获取图层名称为”单个生产线温湿度“的图层
const targetLayer = app.Database.LayerTable.Layers.find(layer => layer.Name === "单个生产线温湿度");
if (targetLayer) {
  //切换到这个图层
    app.Database.LayerTable.ActiveLayerId = targetLayer.ObjectId;
}
```

### 四、举例说明
#### 4.1点击阵列下的节点跳转到另外图层并进行赋值操作
![1735867419305-dbba62c2-bfbc-4c0f-a7f0-3f0ea8d82e85.gif](./img/WkiK6gaYfs6aOXMB/1735867419305-dbba62c2-bfbc-4c0f-a7f0-3f0ea8d82e85-097515.gif)

如上图所示，点击阵列下的标签节点，然后跳转到到对应详情页面，并将标签的标题和状态值传递给详情页面对应的组件属性：

![1735867523734-64e13348-326b-47e7-9925-a670a80fb64c.png](./img/WkiK6gaYfs6aOXMB/1735867523734-64e13348-326b-47e7-9925-a670a80fb64c-015034.png)

![1735867587645-53c3a972-f162-4a19-9ac4-3f90dd3eb1cb.png](./img/WkiK6gaYfs6aOXMB/1735867587645-53c3a972-f162-4a19-9ac4-3f90dd3eb1cb-195990.png)

具体脚本操作如下：

```javascript
//获取阵列对象
const arr = app.getObjectById(523)
arr.Entitys.forEach(e => {//遍历阵列
    const node = e.object;//获取阵列下单个节点
    node.on("click", () => {//阵列下节点单击时动作
        //在单个生产线温度详情页面获取节点，并设置节点值为阵列下节点对应属性
        app.getNodeById(582).Text = node.DataBindRecord.title.value
        app.getNodeById(2918).DataBindRecord["status1"].Value = node.DataBindRecord.status.value//设置状态按钮新的值
       
        // 并切换到名称是"单个生产线温湿度"的图层页面
        const targetLayer = app.Database.LayerTable.Layers.find(layer => layer.Name === "单个生产线温湿度");
        if (targetLayer) {
            app.Database.LayerTable.ActiveLayerId = targetLayer.ObjectId;
        }
    })
})
```

#### 4.2 通过输入框过滤表格数据
如下，输入框输入设备名称后会实时对表格的设备名称列进行模糊搜索

![1736126930623-97ab5bf8-4ff4-4855-92cd-04841675dc00.gif](./img/WkiK6gaYfs6aOXMB/1736126930623-97ab5bf8-4ff4-4855-92cd-04841675dc00-052969.gif)

具体操作如下

1. 通信页面添加设备数据接口

| ![1736127077782-01bd05cc-550d-44f0-a091-d3b63d99efac.png](./img/WkiK6gaYfs6aOXMB/1736127077782-01bd05cc-550d-44f0-a091-d3b63d99efac-098763.png) | ![1736127091853-e1a791f2-061b-484e-b3da-69f4303373e8.png](./img/WkiK6gaYfs6aOXMB/1736127091853-e1a791f2-061b-484e-b3da-69f4303373e8-214484.png) | ![1736127126337-1dce583c-f714-4ebd-936d-23ec7ee25a58.png](./img/WkiK6gaYfs6aOXMB/1736127126337-1dce583c-f714-4ebd-936d-23ec7ee25a58-986075.png) |
| --- | --- | --- |


2. 表格绑定接口数据

| ![1736127267655-289c1876-6dbc-4cf3-9bd9-fb8db6dfc836.png](./img/WkiK6gaYfs6aOXMB/1736127267655-289c1876-6dbc-4cf3-9bd9-fb8db6dfc836-326949.png) | ![1736127283579-1cfd588a-a4c5-4902-a879-ffe639210859.png](./img/WkiK6gaYfs6aOXMB/1736127283579-1cfd588a-a4c5-4902-a879-ffe639210859-723694.png) |
| --- | --- |


3. 蓝图配置

| ![1736127350088-79b7ed05-1800-4bcb-848d-5f15611afb57.png](./img/WkiK6gaYfs6aOXMB/1736127350088-79b7ed05-1800-4bcb-848d-5f15611afb57-416198.png) | ![1736127454819-125db142-764a-4858-9e21-a22b17899671.png](./img/WkiK6gaYfs6aOXMB/1736127454819-125db142-764a-4858-9e21-a22b17899671-152781.png) |
| --- | --- |


#### 4.3 绑定云平台数据并且发送数据到云平台接口
![1736128796910-1c41fd1e-6181-4571-9d43-42d5b11b81ca.gif](./img/WkiK6gaYfs6aOXMB/1736128796910-1c41fd1e-6181-4571-9d43-42d5b11b81ca-219014.gif)

如上，阵列绑定接口数据后，页面刷新时会加载并更新这些数据。用户可以编辑阵列中的节点，点击提交按钮后，数据将实时上报到云平台。操作不需页面刷新，但如果页面被刷新，新的接口数据页会再次更新阵列数据。总之，阵列下节点的数据一直都是最新的。具体操作如下：

1. 添加设备属性数据读取接口和设备属性数据上报接口

读取数据<font style="color:#8A8F8D;">（数据有进行过滤，就需要点击测试连接获取新数据）</font>

| ![1736128879924-aac769e5-12f3-463a-aeb7-26c069b402a2.png](./img/WkiK6gaYfs6aOXMB/1736128879924-aac769e5-12f3-463a-aeb7-26c069b402a2-995721.png) | ![1736128926219-6ec93fdd-252f-4e44-961e-8939475f6815.png](./img/WkiK6gaYfs6aOXMB/1736128926219-6ec93fdd-252f-4e44-961e-8939475f6815-137488.png) | ![1736128968221-de72a512-ca43-4b0e-899c-9d8d8b870b0d.png](./img/WkiK6gaYfs6aOXMB/1736128968221-de72a512-ca43-4b0e-899c-9d8d8b870b0d-014829.png) |
| --- | --- | --- |


数据上报<font style="color:#8A8F8D;">（数据有进行过滤，就需要点击测试连接获取新数据）</font>

| ![1736129002043-6e0dc62b-ed5c-41b0-9f02-3154c6196bfd.png](./img/WkiK6gaYfs6aOXMB/1736129002043-6e0dc62b-ed5c-41b0-9f02-3154c6196bfd-849493.png) | ![1736129019629-b19a5e11-77eb-4cd0-aadc-482958008f2c.png](./img/WkiK6gaYfs6aOXMB/1736129019629-b19a5e11-77eb-4cd0-aadc-482958008f2c-025924.png) |
| --- | --- |


2. 数据绑定

![1736129090906-b8343331-a044-4c1d-b5f4-c72745df48b6.png](./img/WkiK6gaYfs6aOXMB/1736129090906-b8343331-a044-4c1d-b5f4-c72745df48b6-405433.png)

3. 蓝图配置

| ![1736129173351-8003c34d-402f-47fd-8223-e2a609b2d078.png](./img/WkiK6gaYfs6aOXMB/1736129173351-8003c34d-402f-47fd-8223-e2a609b2d078-032175.png) | ![1736129294559-a87dabb5-525b-4724-bbfa-f43ce6c3ff2f.png](./img/WkiK6gaYfs6aOXMB/1736129294559-a87dabb5-525b-4724-bbfa-f43ce6c3ff2f-551414.png) |
| --- | --- |


#### 4.4 阵列数据分页切换效果怎么实现？
![1736145609490-ce459add-0578-41c2-8229-c8d284459bde.gif](./img/WkiK6gaYfs6aOXMB/1736145609490-ce459add-0578-41c2-8229-c8d284459bde-019446.gif)

1. 添加数据，例如添加接口数据<font style="color:#8A8F8D;">（数据有进行过滤，就需要点击测试连接获取新数据）</font>

| ![1736147022918-d50bce04-28e7-4f82-bc95-164278ec27d1.png](./img/WkiK6gaYfs6aOXMB/1736147022918-d50bce04-28e7-4f82-bc95-164278ec27d1-266133.png) | ![1736147031799-13ba554f-c66f-481f-a4a1-85686c90b8b0.png](./img/WkiK6gaYfs6aOXMB/1736147031799-13ba554f-c66f-481f-a4a1-85686c90b8b0-889320.png) |
| --- | --- |


2. 标签右击选择阵列后，设置阵列的行列数量，勾选数据驱动

![1736147719272-fe8e4da0-1fa7-41ae-b8e0-f17b32c62bc7.png](./img/WkiK6gaYfs6aOXMB/1736147719272-fe8e4da0-1fa7-41ae-b8e0-f17b32c62bc7-791200.png)

3. 进行数据绑定

![1736147761903-0ab68510-3fca-488a-9662-e03bfe0d1f69.png](./img/WkiK6gaYfs6aOXMB/1736147761903-0ab68510-3fca-488a-9662-e03bfe0d1f69-391327.png)

4. 蓝图配置

上一页按钮配置

| ![1736148469314-aa4087a7-e172-43d8-aa07-94afc875c1b1.png](./img/WkiK6gaYfs6aOXMB/1736148469314-aa4087a7-e172-43d8-aa07-94afc875c1b1-806692.png) | ![1736148662320-37792b23-4879-4353-94c5-7eeba0e425f2.png](./img/WkiK6gaYfs6aOXMB/1736148662320-37792b23-4879-4353-94c5-7eeba0e425f2-942696.png) |
| --- | --- |


下一页按钮配置

| ![1736148722425-0ce65ea3-5f72-43a7-add7-57bb59d766f6.png](./img/WkiK6gaYfs6aOXMB/1736148722425-0ce65ea3-5f72-43a7-add7-57bb59d766f6-505166.png) | ![1736148782745-5339a15f-cb07-4fdd-a752-d8333e19b785.png](./img/WkiK6gaYfs6aOXMB/1736148782745-5339a15f-cb07-4fdd-a752-d8333e19b785-100042.png) |
| --- | --- |




> 更新: 2025-01-06 15:33:05  
> 原文: <https://www.yuque.com/iot-fast/ksh/tgdtvbcffacif0md>