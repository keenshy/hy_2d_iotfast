# 组合块

准确来说，组合块并不是一种节点，因为它并不继承自基础节点，也不以单一节点的形式存在，而是一种特殊的节点组合方式。组合块是一种将多个节点组合在一起的方式，形成一个整体，方便复用和整体操作。

这和组合节点是完全不同的，你可以想象为组合节点是一个节点，而组合块是一个节点的集合，更像一个分组的概念。

## 如何创建一个组合块
```javascript
// 新建一个组合块
const group = new CollectionRecord();
// 将组合块添加到数据库中
app.Database.CollectionTable.append(group);
```

组合块是单独存储在 Database 的 [CollectionTable](https://v2-doc.gkiiot.com/docs/Core/database#collectiontable) 中

## 如何从组合块中加入和移除节点
```javascript
const node = app.getNodeById(101);
group.append(node.ObjectId);

console.log(node.GroupId === group.ObjectId); // true

// group.remove(node.ObjectId);
```

## 属性和方法
| 属性/方法 | 类型 | 描述 | 示例 |
| --- | --- | --- | --- |
| GroupId | get | 获取组合块的唯一标识 | `const id = newGroup.GroupId` |
| Entitys | get | 获取组合块中的所有节点 | `const nodes = newGroup.Entitys` |
| ClientRect | get | 获取组合块的包围盒 | `const rect = newGroup.ClientRect` |
| Scale | get/set | 获取/设置组合块的缩放比例 | `newGroup.Scale`<br/> `newGroup.Scale = { x: 2, y: 2 }` |
| Position | get/set | 获取/设置组合块的坐标位置 | `newGroup.Position`<br/> `newGroup.Position = { x: 100, y: 100 }` |
| Anchor | get/set | 获取/设置组合块的锚点 | `newGroup.Anchor`<br/> `newGroup.Anchor = { x: 0.5, y: 0.5 }` |
| Rotation | get/set | 获取/设置组合块的旋转角度 | `newGroup.Rotation`<br/> `newGroup.Rotation = 45` |
| Width | get/set | 获取/设置组合块的宽度 | `newGroup.Width`<br/> `newGroup.Width = 100` |
| Height | get/set | 获取/设置组合块的高度 | `newGroup.Height`<br/> `newGroup.Height = 100` |
| IsSelected | get/set | 获取/设置组合块是否选中 | `newGroup.IsSelected`<br/> `newGroup.IsSelected = true` |
| IsPickable | get/set | 获取/设置组合块是否可选 | `newGroup.IsPickable`<br/> `newGroup.IsPickable = false` |
| Visible | get/set | 获取/设置组合块是否可见 | `newGroup.Visible`<br/> `newGroup.Visible = false` |
| LayerId | get | 获取组合块所在的图层 ID | `const layerId = newGroup.LayerId` |
| Name | get/set | 获取/设置组合块的名称 | `newGroup.Name`<br/> `newGroup.Name = "组合块1"` |
| append | method | 添加节点到组合块 | `newGroup.append(node.ObjectId)` |
| remove | method | 从组合块中移除节点 | `newGroup.remove(node.ObjectId)` |
| Animations | get/set | 获取/设置组合块的动画列表 | `newGroup.Animations`<br/> `newGroup.Animations = [animation]` |
| addAnimation | method | 添加动画到组合块 | `newGroup.addAnimation(animation) // animation is GroupAnimation` |
| removeAnimation | method | 从组合块中移除动画 | `newGroup.removeAnimation(animation) // animation is GroupAnimation` |
| doAnimation | method | 执行组合块上的所有动画 | `newGroup.doAnimation()` |
| traverse | method | 遍历组合块中的所有节点 | `newGroup.traverse((node) => { console.log(node) })` |
| RenderIndex | get/set | 获取/设置组合块的渲染层级，这将决定组合块和块内所有节点，相对于组合块相邻节点的渲染顺序 | `const index = node.RenderIndex`<br/> `node.RenderIndex = 10` |
| fromJSON | method | 从 JSON 数据中反序列化组合块 | `newGroup.fromJSON(json)` |
| toJSON | method | 序列化组合块 | `const json = newGroup.toJSON()` |


## 状态组合块
状态组合是一种特殊的组合块，除了具备组合的基础能力外，还具备了状态管理的能力。状态组合通过保存和管理状态，切换状态，可以切换组合块内显示的节点。

```javascript
const group = new StateCollectionRecord();
app.Database.CollectionTable.append(group);
group.append(node1.ObjectId);
group.append(node2.ObjectId);

/*
 *- StateType: 状态类型，可以是 Number = 0/ Boolean = 1 /String = 2
 */
group.StateType = EStateType.Number;

group.CurrentState = 1; // 切换到状态1,此时只有node2节点会显示
group.CurrentState = 0; // 切换到状态0,此时只有node1显示
```

并且，通过点击组合块的范围区间，可以对组合块状态进行切换，从而切换显示的节点。

| 属性/方法 | 类型 | 描述 | 示例 |
| --- | --- | --- | --- |
| StateType | get/set | 获取/设置状态组合块的状态类型 | `group.StateType`<br/> `group.StateType = EStateType.Number` |
| CurrentState | get/set | 获取/设置当前状态 | `group.CurrentState`<br/> `group.CurrentState = 1` |
| getNodeVisibleStatus | method | 获取节点的可见状态 | `group.getNodeVisibleStatus(node.ObjectId)` |
| update | method | 更新状态组合块 | `group.update()` |


## 阵列组合块
阵列组合块也是一种特殊的组合块，是将一个节点，进行复制，形成一个阵列的组合块。阵列组合块可以设置阵列的行列数，间距等属性。

| 属性/方法 | 类型 | 描述 | 示例 |
| --- | --- | --- | --- |
| Row | get/set | 获取/设置阵列组合块的行数 | `arrayGroup.Row`<br/> `arrayGroup.Row = 2` |
| Col | get/set | 获取/设置阵列组合块的列数 | `arrayGroup.Col`<br/> `arrayGroup.Col = 2` |
| IsArrayByData | get/set | 获取/设置阵列组合块是否根据数据进行阵列 | `arrayGroup.IsArrayByData`<br/> `arrayGroup.IsArrayByData = true` |
| Spacing | get/set | 获取/设置阵列组合块的间距 | `arrayGroup.Spacing`<br/> `arrayGroup.Spacing = 10` |
| DataList | get/set | 获取/设置阵列组合块的数据列表 | `arrayGroup.DataList`<br/> `arrayGroup.DataList = [1, 2, 3]` |
| DataIndex | get/set | 获取/设置阵列组合块的数据索引 | `arrayGroup.DataIndex`<br/> `arrayGroup.DataIndex = 1` |




<font style="color:rgb(28, 30, 33);">  
</font>



> 更新: 2024-09-30 10:37:13  
> 原文: <https://www.yuque.com/iot-fast/ksh/kp1nkl7ka0y66fiy>