# 组合节点

<font style="color:rgb(28, 30, 33);">组合节点基于基础节点，可以包含多个子节点，形成一个整体。一般用于将多个图形组合在一起，形成一个复杂的图形，方便复用和整体操作。</font>

<font style="color:rgb(28, 30, 33);">编辑器中的【设计】的概念，就是将许多节点组合在一起，形成一个组合节点，最后应用于场景画布中。</font>

```javascript
class CompositeNodeRect extends BaseNode {
  static type = "CompositeNode";
  protected _name = "组合节点";
  ...
}
```

## <font style="color:rgb(28, 30, 33);">如何创建一个组合节点</font>
```javascript
const compositeNode = new CompositeNodeRect();
```

## <font style="color:rgb(28, 30, 33);">常用的属性和方法</font>
<font style="color:rgb(28, 30, 33);">组合节点是基础节点的扩展，它具有基础节点所有的</font><font style="color:rgb(28, 30, 33);"> </font>[<font style="color:rgb(28, 30, 33);">属性和方法</font>](https://v2-doc.gkiiot.com/docs/Node/basenode#%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95)<font style="color:rgb(28, 30, 33);">，需要注意的是，对组合节点进行的操作会同时影响到组合节点下的所有子节点。</font>

<font style="color:rgb(28, 30, 33);">除此之外，组合节点还有以下一些特有的属性和方法:</font>

### <font style="color:rgb(28, 30, 33);">子节点</font>
<font style="color:rgb(28, 30, 33);">子节点是组合节点的特殊属性，它表示当前组合节点包含的所有子节点。通过对子节点属性的操作，可以对组合节点的所有子节点进行操作。</font>

```javascript
// 获取组合节点下的所有子节点
const nodes = compositeNode.Nodes;
// 假设存在一个ID为101的节点，通过 ID 获取节点
const exNode = app.getNodeById(101);
// 将该节点添加到组合节点中，等价于 compositeNode.adddNode(exNode)
compositeNode.Nodes = [...compositeNode.Nodes, exNode];
// 移除ID为101的子节点，等价于 compositeNode.removeNode(exNode)
compositeNode.Nodes = compositeNode.Nodes.filter((node) => node.Id !== 101);
```

### <font style="color:rgb(28, 30, 33);">数据绑定</font>
<font style="color:rgb(28, 30, 33);">数据绑定是组合节点的重要概念。你可以理解为，在组合节点里，我们维护和保存了一份数据绑定的关系，当数据绑定发生变化时，会自动更新到所有存在绑定关系子节点上，以此修改它们的属性。</font>

```javascript
/*
 * dataBind的值为一个数组，数组中的每一项都是一个对象，对象包含了数据绑定的信息。
 * 对象包含了几个重要的属性
 * - nodeId: 子节点ID，表示数据绑定的节点
 * - value: 数据绑定的值
 * - valueType: 数据绑定的值类型， Strign / Number / Boolean ....
 * - bindName: 数据绑定的名称
 * - label: 数据绑定的标签描述
 * - attrName: 数据绑定的属性名称，可能是Width这样的属性
 * - attrType: "attr" | "func"，属性绑定可以是简单的属性绑定，也可以是通过函数计算的属性绑定
 * - script: 数据绑定的脚本内容
 * - func: 当AttrType为func时，通过Func来执行Script脚本，返回计算后的值
 */
const dataBind = compositeNode.DataBind;
```

<font style="color:rgb(28, 30, 33);">通过修改组合节点中数据绑定的值,可以使对应的子节点属性发生变化。</font>

<font style="color:rgb(28, 30, 33);">例如, 当一个组合节点由一个文本节点和一个圆形节点组成, 设置两个数据绑定,一个是文本节点的文本内容,一个是圆形节点的背景色。</font>

```javascript
// 假设存在以下三个节点
const textNode = app.getNodeById(102);
const circleNode = app.getNodeById(103);

const compositeNode = new CompositeNodeRect();
compositeNode.Nodes = [textNode, circleNode];

compositeNode.DataBind = [
  {
    nodeId: 102,
    value: "这是文本内容",
    valueType: "String",
    bindName: "textContent",
    label: "文本",
    attrName: "Text",
    attrType: "attr",
    enable: false,
  },
  {
    nodeId: 103,
    value: "green",
    valueType: "Color",
    bindName: "bgColor",
    label: "背景色",
    attrName: "Background",
    attrType: "attr",
    enable: false,
  },
];

app.Database.NodeSpace.append(compositeNode);

compositeNode.DataBindRecord.textContent.Value = "新的文本内容"; // 修改文本节点的文本内容
compositeNode.DataBindRecord.bgColor.Value = "red"; // 修改圆形节点的背景色
```



> 更新: 2024-09-30 10:37:03  
> 原文: <https://www.yuque.com/iot-fast/ksh/cig7ys6oahtzga08>